<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.bootcss.com/element-ui/2.13.2/theme-chalk/index.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/yxt.css">
    <title>课程详情</title>
    <style>
        #course-resources-card>.el-card__body {
            padding: 0;
        }

        #resource-upload-btn>.el-upload {
            display: block;
        }

        .custom-tree-node {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            padding-right: 8px;
        }
    </style>
</head>

<body>
    <div id="app">
        <el-container>
            <!-- 头部 -->
            <el-header>
                <!-- 导航栏：logo、菜单功能、头像下拉菜单 -->
                <el-row>
                    <!-- logo -->
                    <el-col :span="4">
                        <!-- <el-image style="margin-top: 10px;" src="./images/logo_blue.png" fit="contain"></el-image> -->
                        <el-image>
                            <div slot="error" class="image-slot">
                                <div class="header-logo">LOGO</div>
                            </div>
                        </el-image>
                    </el-col>
                    <!-- 菜单功能 -->
                    <el-col :span="16">
                        <el-menu :default-active="activeIndex" mode="horizontal">
                            <el-menu-item index="1" class="header-text" @click="location.href = '../homePage.html'">课堂
                            </el-menu-item>
                            <el-menu-item index="2" class="header-text">精品课程</el-menu-item>
                            <el-menu-item index="3" class="header-text">本校课程</el-menu-item>
                            <el-menu-item index="4" class="header-text">我的精品</el-menu-item>
                        </el-menu>
                    </el-col>
                    <!-- 消息提醒 -->
                    <el-col :span="1.5">
                        <el-menu class="el-menu-demo" mode="horizontal">
                            <el-submenu>
                                <template slot="title">
                                    <i class="el-icon-bell"></i>
                                    <el-badge v-show="totalUnreadCount != 0" :value="totalUnreadCount" :max="10"
                                        class="item">
                                </template>
                                <el-menu-item @click="location.href = 'user/message.html' "><i
                                        class="el-icon-message-solid"></i> 系统通知 <el-badge
                                        v-if="unreadMessageCount.systemMessageCount != 0"
                                        :value="unreadMessageCount.systemMessageCount" class="item">
                                </el-menu-item>
                                <el-menu-item @click="location.href = 'user/message.html' "><i
                                        class="el-icon-notebook-2"></i> 课程相关 <el-badge
                                        v-if="unreadMessageCount.courseMessageCount != 0"
                                        :value="unreadMessageCount.courseMessageCount" class="item">
                                </el-menu-item>
                                <el-menu-item @click="location.href = 'user/message.html' "><i
                                        class="fa fa-mail-forward" style="margin-left: 6px; margin-right: 10px;"></i>
                                    回复我的 <el-badge v-if="unreadMessageCount.replyMessageCount != 0"
                                        :value="unreadMessageCount.replyMessageCount" class="item">
                                </el-menu-item>
                                <el-menu-item @click="location.href = 'user/message.html' "><i class="fa fa-thumbs-o-up"
                                        style="margin-left: 6px; margin-right: 12px;"></i> 收到的赞 <el-badge
                                        v-if="unreadMessageCount.voteUpMessageCount != 0"
                                        :value="unreadMessageCount.voteUpMessageCount" class="item">
                                </el-menu-item>
                                <el-menu-item @click="location.href = 'user/message.html' "><i
                                        class="el-icon-chat-dot-round"></i> 我的私信 <el-badge
                                        v-if="unreadMessageCount.chatMessageCount != 0"
                                        :value="unreadMessageCount.chatMessageCount" class="item">
                                </el-menu-item>
                            </el-submenu>
                        </el-menu>
                    </el-col>
                    <!-- 头像下拉菜单 -->
                    <el-col :span="2.5">
                        <el-menu class="el-menu-demo" mode="horizontal">
                            <el-submenu>
                                <template slot="title">
                                    <span v-text="user.username" style="color: black; margin: 20px 10px;">用户名</span>
                                    <el-avatar size="large" :src="user.avatar">
                                    </el-avatar>
                                </template>
                                <el-menu-item @click="location.href = 'user/setting.html' "><i
                                        class="el-icon-setting"></i> 个人设置</el-menu-item>
                                <el-menu-item @click="location.href = 'user/message.html' "><i
                                        class="el-icon-position"></i> 消息中心</el-menu-item>
                                <el-menu-item @click="logout()"><i class="fa fa-sign-out"
                                        style="margin-left: 6px; margin-right: 9px;"></i>
                                    <span>退出账户</span>
                                </el-menu-item>
                            </el-submenu>
                        </el-menu>
                    </el-col>
                </el-row>
            </el-header>

            <!-- 中间 -->
            <el-container style="width: 1224px;margin: auto">
                <el-main style="margin-top: 60px;">
                    <!-- 课程基本信息 -->
                    <div id="course-header"
                        style="border-radius: 10px;margin: auto;height: 200px;width:1224px;background-image: url('https://assets.ketangpai.com/theme/teacher/big/20.png')">
                        <el-row style="height: 200px">
                            <el-col :span="12">
                                <el-row id="course-name">
                                    <el-col :span="12">
                                        <div id="top-menu" style="padding-left: 40px;width: 612px">
                                            <div id="course-name"
                                                style="color: white;font-size: 36px;float: left;text-align: left;padding-top: 40px;width: 612px">
                                                <span style="width: 612px" v-text="course.cname">课程名称</span>
                                                <el-link v-show="user.isTeacher"
                                                    @click="dialogUpdateCourseFormVisible = true"
                                                    icon="el-icon-edit-outline" :underline="false"
                                                    style="font-size: x-large;color: white">
                                                </el-link>
                                                <el-dialog title="编辑课程" :visible.sync="dialogUpdateCourseFormVisible"
                                                    destroy-on-close @close="dialogUpdateCourseFormVisible=false"
                                                    @closed="updateCourseForm=Object.assign({},course)">
                                                    <el-form :model="updateCourseForm" ref="updateCourseForm">
                                                        <el-form-item label="课程名称" :label-width="formLabelWidth">
                                                            <el-input v-model="updateCourseForm.cname"
                                                                placeholder="请输入课程名称" autocomplete="off"></el-input>
                                                        </el-form-item>
                                                        <el-form-item label="班级名称" :label-width="formLabelWidth">
                                                            <el-input v-model="updateCourseForm.clazz"
                                                                placeholder="请输入班级名称" autocomplete="off"></el-input>
                                                        </el-form-item>
                                                        <el-form-item label="学年-学期" :label-width="formLabelWidth">
                                                            <el-select v-model="updateCourseForm.schoolYear"
                                                                placeholder="请选择学年" style="width: 390px">
                                                                <el-option label="2019-2020" value="2019-2020">
                                                                </el-option>
                                                                <el-option label="2020-2021" value="2020-2021">
                                                                </el-option>
                                                                <el-option label="2021-2022" value="2021-2022">
                                                                </el-option>
                                                            </el-select>
                                                            <el-select v-model="updateCourseForm.semester"
                                                                placeholder="请选择学期" style="width: 390px">
                                                                <el-option label="不限" value="不限"></el-option>
                                                                <el-option label="第一学期" value="第一学期"></el-option>
                                                                <el-option label="第二学期" value="第二学期"></el-option>
                                                            </el-select>
                                                        </el-form-item>
                                                    </el-form>
                                                    <div slot="footer" class="dialog-footer">
                                                        <el-button @click="dialogUpdateCourseFormVisible = false">取 消
                                                        </el-button>
                                                        <el-button type="primary"
                                                            @click="updateCourse('updateCourseForm')">确 定</el-button>
                                                    </div>
                                                </el-dialog>
                                            </div>
                                        </div>
                                    </el-col>
                                    <el-col :span="12"></el-col>
                                </el-row>
                                <el-row id="course-buttons" style="height: 113px">
                                    <el-col :span="24">
                                        <div id="box-box" style="padding-left: 40px;padding-top: 20px">
                                            <el-row :gutter="30">
                                                <el-col :span="5">
                                                    <div id="qr-code"
                                                        style="border-radius: 3px;color: white;height: 24px;background-color: #909399;font-size: 12px">
                                                        <el-link :underline="false" style="color: white">
                                                            <div id="qr-code-content" style="padding-top: 3px">
                                                                <i class="fa fa-qrcode"></i>
                                                                <span>加课二维码</span>
                                                            </div>
                                                        </el-link>
                                                    </div>
                                                </el-col>
                                                <el-col :span="6">
                                                    <div id="course-code"
                                                        style="border-radius: 3px;color: white;height: 24px;background-color: #909399;font-size: 12px">
                                                        <el-dropdown v-show="user.isTeacher">
                                                            <span class="el-dropdown-link">
                                                                <el-link :underline="false" style="color: white">
                                                                    <div id="course-code-content"
                                                                        style="padding-top: 3px">
                                                                        <span>加课码:</span>
                                                                        <span v-text="course.ccode">R6AD65</span>
                                                                    </div>
                                                                </el-link>
                                                            </span>
                                                            <el-dropdown-menu slot="dropdown"
                                                                style="width: 106px;text-align: center">
                                                                <!-- <el-dropdown-item>停用</el-dropdown-item> -->
                                                                <el-dropdown-item>
                                                                    <el-link @click="resetCourseCode()">重置</el-link>
                                                                </el-dropdown-item>
                                                            </el-dropdown-menu>
                                                        </el-dropdown>
                                                        <el-dropdown v-show="!user.isTeacher">
                                                            <span class="el-dropdown-link">
                                                                <el-link :underline="false" style="color: white">
                                                                    <div id="course-code-content"
                                                                        style="padding-top: 3px">
                                                                        <span>加课码:</span>
                                                                        <span v-text="course.ccode">R6AD65</span>
                                                                    </div>
                                                                </el-link>
                                                            </span>
                                                        </el-dropdown>
                                                    </div>
                                                </el-col>
                                                <el-col :span="4">
                                                    <div id="course-member"
                                                        style="border-radius: 3px;color: white;height: 24px;background-color: #909399;font-size: 12px">
                                                        <el-link :underline="false" style="color: white"
                                                            :href="'courseMembers.html?courseId=' + course.id">
                                                            <div id="course-member-content" style="padding-top: 3px">
                                                                <i class="fa fa-user-o"></i>
                                                                <span>成员</span>
                                                                <span v-text="course.scount + 1">25</span>
                                                            </div>
                                                        </el-link>
                                                    </div>
                                                </el-col>
                                                <el-col :span="5">
                                                    <div id="course-data"
                                                        style="border-radius: 3px;color: white;height: 24px;background-color: #909399;font-size: 12px">
                                                        <el-link :underline="false" style="color: white">
                                                            <div id="course-data-content" style="padding-top: 3px">
                                                                <i class="fa fa-bar-chart"></i>
                                                                <span>数据分析</span>
                                                            </div>
                                                        </el-link>
                                                    </div>
                                                </el-col>
                                                <el-col :span="4">
                                                    <div id="course-score"
                                                        style="border-radius: 3px;color: white;width: 80px;height: 24px;background-color: #909399;font-size: 12px">
                                                        <el-link :underline="false" style="color: white">
                                                            <div id="course-score-content" style="padding-top: 3px">
                                                                <i class="fa fa-mortar-board"></i>
                                                                <span>成绩管理</span>
                                                            </div>
                                                        </el-link>
                                                    </div>
                                                </el-col>
                                            </el-row>
                                        </div>
                                    </el-col>
                                    <el-col :span="12"></el-col>
                                </el-row>
                            </el-col>
                            <el-col :span="12">
                                <div id="course-statics">
                                    <el-row
                                        style="padding-left: 160px;padding-right: 50px;height: 200px;color: white;padding-top: 40px">
                                        <el-col :span="6">
                                            <ul style="list-style: none">
                                                <li style="font-size: 48px" v-text="homeworkCount">1</li>
                                                <li style="font-size: 14px">发布作业</li>
                                            </ul>
                                        </el-col>
                                        <el-col :span="6">
                                            <ul style="list-style: none">
                                                <li style="font-size: 48px" v-text="resourceCount">3</li>
                                                <li style="font-size: 14px">发布资料</li>
                                            </ul>
                                        </el-col>
                                        <el-col :span="6">
                                            <ul style="list-style: none">
                                                <li style="font-size: 48px" v-text="examCount">2</li>
                                                <li style="font-size: 14px">发布考试</li>
                                            </ul>
                                        </el-col>
                                        <el-col :span="6">
                                            <ul style="list-style: none">
                                                <li style="font-size: 48px" v-text="noticeCount">2</li>
                                                <li style="font-size: 14px">发布公告</li>
                                            </ul>
                                        </el-col>
                                    </el-row>
                                </div>
                            </el-col>
                        </el-row>
                    </div>
                    <!-- 课程子模块菜单 -->
                    <div id="course-menu">
                        <el-menu :default-active="activeIndex2" mode="horizontal" @select="handleSelect2">
                            <el-menu-item index="1" style="width: 200px">
                                <span style="font-size: 16px">作业</span>
                            </el-menu-item>
                            <el-menu-item index="2" style="width: 200px">
                                <span style="font-size: 16px">资料</span>
                            </el-menu-item>
                            <el-menu-item index="3" style="width: 200px">
                                <span style="font-size: 16px">测试（考试）</span>
                            </el-menu-item>
                            <el-menu-item index="4" style="width: 200px">
                                <span style="font-size: 16px">公告</span>
                            </el-menu-item>
                        </el-menu>
                    </div>
                    <!-- 作业模块 -->
                    <div id="course-homework" v-if="activeIndex2=='1'" style="margin-top: 30px">
                        <!-- 发布作业按钮 -->
                        <div id="course-homework-menubar" v-if="user.isTeacher">
                            <el-row>
                                <el-col :span="12">
                                    <el-button @click="showInputHomeworkForm" :disabled="homeworkFormVisible"
                                        type="primary" plain style="float: left">发布个人作业</el-button>
                                </el-col>
                                <el-col :span="12">
                                    <div id="homework-manage" style="float:right;">
                                        <el-link :underline="false">
                                            <i class="fa fa-file-text-o"></i>
                                            <span>作业成绩管理</span>
                                        </el-link>
                                    </div>
                                    <!-- <div id="homework-download" style="float:right;padding-right: 20px">
                                        <el-link :underline="false">
                                            <i class="fa fa-download"></i>
                                            <span>下载所有作业</span>
                                        </el-link>
                                    </div> -->
                                </el-col>
                            </el-row>
                        </div>
                        <!-- 作业列表 -->
                        <div id="course-homework-box">
                            <div id="course-homework-card" style="width: 1224px;margin-top: 30px">
                                <el-card class="box-card" v-for="(homework, index) in homeworkList"
                                    v-show="homeworkList.length > 0"
                                    style="margin-top: 20px;width: 1184px;height: 220px;border-radius: 6px;border-width: 2px">
                                    <el-row id="course-title" style="height: 30px">
                                        <el-col :span="12">
                                            <div class="homework-create-time" style="float: left">
                                                <el-tag v-show="homework.topNum != 0" size="medium" type="danger">置顶
                                                </el-tag>
                                                <span style="padding-left: 30px;font-size: 15px;color: #A0A0A0"
                                                    v-text="homework.createTime">2020-11-09 22:17</span>
                                            </div>
                                        </el-col>
                                        <el-col :span="12" v-show="user.isTeacher">
                                            <div class="homework-operation" style="float: right">
                                                <el-dropdown>
                                                    <span class="el-dropdown-link">
                                                        更多操作 <i class="el-icon-more"></i>
                                                    </span>
                                                    <el-dropdown-menu slot="dropdown">
                                                        <el-dropdown-item>
                                                            <router-link @click="switchHomeworkTop(homework.id)"
                                                                v-if="homework.topNum === 0">
                                                                置顶
                                                            </router-link>
                                                            <router-link @click="switchHomeworkTop(homework.id)" v-else>
                                                                取消置顶
                                                            </router-link>
                                                        </el-dropdown-item>
                                                        <el-dropdown-item>
                                                            <router-link @click="showEditHomeworkForm(homework.id)">编辑
                                                            </router-link>
                                                        </el-dropdown-item>
                                                        <!-- <el-dropdown-item>保存到...</el-dropdown-item> -->
                                                        <!-- <el-popover placement="top" width="160"
                                                            v-model="delHomeworkVisible">
                                                            <p>确认要删除此作业吗？</p>
                                                            <div style="text-align: right; margin: 0">
                                                                <el-button size="mini" type="text"
                                                                    @click="delHomeworkVisible = false">取消</el-button>
                                                                <el-button type="primary" size="mini"
                                                                    @click="deleteHomework(homework.id)">确定</el-button>
                                                            </div>
                                                            <el-dropdown-item slot="reference">删除</el-dropdown-item>
                                                        </el-popover> -->
                                                        <el-popconfirm confirmButtonText="确认" cancelButtonText="取消"
                                                            confirmButtonType="danger" cancelButtonType="success"
                                                            placement="top" @onConfirm="deleteHomework(homework.id)"
                                                            title="确认要删除此作业吗？">
                                                            <el-dropdown-item slot="reference">删除</el-dropdown-item>
                                                        </el-popconfirm>
                                                    </el-dropdown-menu>
                                                </el-dropdown>
                                            </div>
                                        </el-col>
                                    </el-row>
                                    <el-row id="course-announce" style="height: 130px">
                                        <el-col :span="12">
                                            <el-row style="height: 45px">
                                                <el-col :span="24">
                                                    <el-link :underline="false"
                                                        style="font-size: 26px;float: left;padding-left: 30px;margin-top: 10px;"
                                                        :href="user.isTeacher ? './homeworkReview.html?id=' + homework.id : 'submitHomework.html?id=' + homework.id">
                                                        <span style="font-weight: bold"
                                                            v-text="homework.title">范例_第一次作业</span>
                                                    </el-link>
                                                </el-col>
                                            </el-row>
                                            <el-row style="height: 85px">
                                                <el-col :span="24">
                                                    <span
                                                        style="float: left;padding-left: 30px;padding-top: 5px;margin-top: 10px;">
                                                        <span style="font-size: 15px;color: #707070"
                                                            v-text="getSimpleText(homework.description)">如题所述</span>
                                                    </span>
                                                </el-col>
                                            </el-row>
                                        </el-col>
                                        <el-col :span="12">
                                            <div class="homework-statics" style="height: 130px">
                                                <el-row style="height: 130px;padding-top: 30px" v-if="user.isTeacher">
                                                    <el-col :span="8">
                                                        <ul style="list-style: none">
                                                            <li>
                                                                <el-link :underline="false"
                                                                    style="font-size: 30px;color: #32C76E"
                                                                    v-text="homework.correctedCount">15</el-link>
                                                            </li>
                                                            <li style="font-size: 14px;color: #707070">已批</li>
                                                        </ul>
                                                    </el-col>
                                                    <el-col :span="8">
                                                        <ul style="list-style: none">
                                                            <li>
                                                                <el-link :underline="false"
                                                                    style="font-size: 30px;color: #707070"
                                                                    v-text="homework.uncorrectedCount">4</el-link>
                                                            </li>
                                                            <li style="font-size: 14px;color: #970002">未批</li>
                                                        </ul>
                                                    </el-col>
                                                    <el-col :span="8">
                                                        <ul style="list-style: none">
                                                            <li>
                                                                <el-link :underline="false"
                                                                    style="font-size: 30px;color: #E03838"
                                                                    v-text="homework.uncommittedCount">5</el-link>
                                                            </li>
                                                            <li style="font-size: 14px;color: #707070">未交</li>
                                                        </ul>
                                                    </el-col>
                                                </el-row>
                                                <el-row style="height: 130px;padding-top: 30px" v-else>
                                                    <el-col :span="5" style="float: right; margin-top: 40px;">
                                                        <el-tag type="danger"
                                                            v-show="studentHomework[homework.id] === 0">未完成</el-tag>
                                                        <el-tag type="success"
                                                            v-show="studentHomework[homework.id] === 1">已提交</el-tag>
                                                        <el-tag type="primary"
                                                            v-show="studentHomework[homework.id] === 2">已批改</el-tag>
                                                    </el-col>
                                                </el-row>
                                            </div>
                                        </el-col>
                                    </el-row>
                                    <el-row id="course-message" style="height: 60px">
                                        <el-row>
                                            <el-col style="height: 50px">
                                                <span
                                                    style="font-size: 15px;color: #A0A0A0;float: left;padding-left: 30px;padding-top: 0;padding-bottom: 10px">
                                                    <i class="el-icon-timer"></i> 截止日期：<span
                                                        v-text="homework.deadline">2020-11-07 22:17</span>
                                                </span>
                                            </el-col>
                                        </el-row>
                                    </el-row>
                                </el-card>

                                <el-card class="box-card" v-show="homeworkList.length === 0"
                                    style="margin-top: 20px;width: 1184px;height: 220px;border-radius: 6px;border-width: 2px">
                                    <el-row>
                                        <p
                                            style="text-align: center; font-size: 15px; color: black; line-height: 160px;">
                                            该课程暂无作业</p>
                                    </el-row>
                                </el-card>
                            </div>
                        </div>
                    </div>
                    <!-- 资源模块 -->
                    <div id="course-resources" v-if="activeIndex2=='2'" style="margin-top: 30px">
                        <div v-if="user.isTeacher">
                            <el-row>
                                <el-upload id="resource-upload-btn" action="#" :show-file-list="false"
                                    :before-upload="beforeResourceUpload" :http-request="uploadResource">
                                    <el-button type="primary" plain style="float: left"><i class="el-icon-upload"></i>
                                        上传资源
                                    </el-button>
                                </el-upload>
                                <el-button type="primary" plain style="float: left; margin-left: 8px;"
                                    @click="createFolderFormVisible = true"><i class="el-icon-folder-add"></i> 新建文件夹
                                </el-button>
                                <el-button type="primary" plain style="float: left; margin-left: 8px;"
                                    @click="resourceManageDialogVisible = true"><i class="el-icon-folder"></i> 资源管理
                                </el-button>
                                <!-- 创建文件夹表单 -->
                                <el-dialog title="创建文件夹" :visible.sync="createFolderFormVisible" destroy-on-close
                                    @close="resourceForm = {}" center width="30%">
                                    <el-form :model="resourceForm" ref="folderCreateForm" :rules="resourceRule"
                                        hide-required-asterisk="true">
                                        <el-form-item prop="name">
                                            <el-input v-model="resourceForm.name" autocomplete="off"
                                                prefix-icon="el-icon-folder-add" placeholder="请输入文件夹名称" clearable>
                                            </el-input>
                                        </el-form-item>
                                    </el-form>
                                    <div slot="footer">
                                        <el-row>
                                            <el-button type="primary" @click="createFolder('folderCreateForm')"
                                                style="display: block; width: 100%;">确定
                                            </el-button>
                                        </el-row>
                                    </div>
                                </el-dialog>
                                <!-- 资源管理对话框 -->
                                <el-dialog title="课程资源管理" :visible.sync="resourceManageDialogVisible" destroy-on-close
                                    center @opened="getCourseResourceList()" @closed="getResourceData(course.id, -1)">
                                    <el-tree :data="courseResourceList" node-key="id" :props="myProps"
                                        default-expand-all draggable @node-drop="handleDrop">
                                        <span class="custom-tree-node" slot-scope="{ node, data }">
                                            <span><img :src="getResourceSrcByName(node.label)" alt="" srcset=""
                                                    style="height: 16px; width: 16px; margin-right: 5px;">{{ node.label
                                                }}</span>
                                            <span>
                                                <el-button type="text" size="mini"
                                                    @click="showRenameResourceForm(node, data)">
                                                    <i class="el-icon-edit"></i>
                                                </el-button>
                                                <el-popconfirm confirmButtonText="确认" cancelButtonText="取消"
                                                    confirmButtonType="danger" cancelButtonType="success"
                                                    placement="left" @onconfirm="remove(node, data)" title="确认要删除该资源吗？">
                                                    <el-button size="mini" slot="reference" type="text"
                                                        slot="reference">
                                                        <i class="el-icon-delete"></i>
                                                    </el-button>
                                                </el-popconfirm>
                                            </span>
                                        </span>
                                    </el-tree>
                                </el-dialog>
                                <!-- 重命名资源表单 -->
                                <el-dialog title="重命名资源" :visible.sync="renameResourceFormVisible" destroy-on-close
                                    @closed="resourceForm = {}" center width="30%">
                                    <el-form :model="resourceForm" ref="resourceRenameForm" :rules="resourceRule"
                                        hide-required-asterisk="true">
                                        <el-form-item prop="name">
                                            <el-input v-model="resourceForm.name" autocomplete="off"
                                                :prefix-icon="resourceForm.type === 0 ? 'el-icon-folder' : 'el-icon-document'"
                                                placeholder="请输入资源名称" clearable>
                                            </el-input>
                                        </el-form-item>
                                    </el-form>
                                    <div slot="footer">
                                        <el-row>
                                            <el-button type="primary" @click="renameResource('resourceRenameForm')"
                                                style="display: block; width: 100%;">确定
                                            </el-button>
                                        </el-row>
                                    </div>
                                </el-dialog>
                            </el-row>
                        </div>
                        <div class="course-resources-box">
                            <el-card class="box-card" id="course-resources-card"
                                style="margin-top: 20px;width: 1184px;height: auto; border-radius: 6px;border-width: 2px;padding: 0;">
                                <div style="width: 1144px">
                                    <el-container>
                                        <el-header style="background-color:#F1F3F4; width: 1200px;">
                                            <span style="float: left;" v-html="breadcrumb">
                                                <el-button type="text" style="color: #3b3d45;">所有文件</el-button>
                                                <i class="el-icon-arrow-right"></i>
                                                <el-button type="text" style="color: #3b3d45;">实验</el-button>
                                                <i class="el-icon-arrow-right"></i>
                                                <el-button type="text">实验一</el-button>
                                            </span>
                                        </el-header>
                                        <!-- 资源列表 -->
                                        <el-main>
                                            <el-row type="flex" justify="space-start" :gutter="20" style="margin: 40px;"
                                                v-for="(row, index) of resourceListRows" :key="index"
                                                v-show="resourceListRows.length > 0">
                                                <el-col :span="3" style="margin-right: 25px;"
                                                    @mouseover.native="showDownloadResourceId = resource.id"
                                                    @mouseout.native="showDownloadResourceId = -1"
                                                    v-for="(resource, innerindex) in row" :key="resource.id">
                                                    <el-row>
                                                        <el-button style="height: 150px; width: 129px; padding: 12px 0;"
                                                            @click="previewOrGetResourceData(resource.id, resource.type, resource.name)">
                                                            <el-row style="margin-bottom: 15px;">
                                                                <img :src="getResourceSrc(resource.ext)" alt=""
                                                                    srcset="" style="height: 48px; width: 48px;">
                                                            </el-row>
                                                            <el-row>
                                                                <el-tooltip :content="resource.name" placement="bottom"
                                                                    effect="light">
                                                                    <span style="font-size: 10px;"
                                                                        v-text="resource.name.length > 7 ? resource.name.substring(0, 7) + '...': resource.name">实验</span>
                                                                </el-tooltip>
                                                            </el-row>
                                                        </el-button>
                                                    </el-row>
                                                    <el-row>
                                                        <el-button type="text" size="small"
                                                            @click="postDownloadRequestToServer(resource.id)">
                                                            <span
                                                                v-show="resource.type === 1 && resource.id === showDownloadResourceId">下载</span>
                                                        </el-button>
                                                    </el-row>
                                                </el-col>
                                            </el-row>
                                            <el-row v-show="resourceListRows.length === 0">
                                                <p
                                                    style="text-align: center; font-size: 15px; color: black; line-height: 160px;">
                                                    该目录下暂无文件</p>
                                            </el-row>
                                        </el-main>
                                    </el-container>
                                </div>
                            </el-card>
                        </div>

                    </div>
                    <!-- 测试（考试）模块 -->
                    <div id="course-exam" v-if="activeIndex2=='3'">
                        <div id="course-exam-box" style="margin-top: 30px">
                            <div id="exam-buttons" v-if="user.isTeacher">
                                <el-row>
                                    <el-col :span="12">
                                        <el-button type="primary" style="float: left;" @click="showInputExamForm()">
                                            <i class="el-icon-plus"></i>
                                            新建测试（考试）
                                        </el-button>
                                    </el-col>
                                    <el-col :span="12">
                                        <!-- <el-button type="primary" plain>
                                            导入测试（考试）
                                        </el-button>
                                        <el-link type="primary" :underline="false" style="padding-left: 30px">先去备课区组卷
                                        </el-link> -->
                                        <div style="float: right;">
                                            <el-link :underline="false">
                                                <i class="el-icon-document"></i>
                                                测试成绩管理
                                            </el-link>
                                        </div>
                                        <!-- <el-link :underline="false" style="padding-left: 30px">
                                            <i class="el-icon-download"></i>
                                            下载所有测试
                                        </el-link> -->
                                    </el-col>
                                </el-row>
                            </div>
                            <div id="exam-menubar" style="margin-top: 10px">
                                <el-row>
                                    <el-col :span="24">
                                        <el-tabs v-model="activeName">
                                            <!-- 全部测试 -->
                                            <el-tab-pane :label="'全部(' + examList.length + ')'" name="first">
                                                <div class="exam-cards">
                                                    <el-card class="box-card" v-for="(exam, index) in examList"
                                                        v-if="examList.length > 0"
                                                        style="margin-top: 20px;width: 1184px;height: 230px;border-radius: 6px;border-width: 2px">
                                                        <el-row id="course-title" style="height: 30px">
                                                            <el-col :span="14">
                                                                <div class="homework-create-time" style="float: left">
                                                                    <el-tag type="info" v-show="exam.topNum > 0">置顶
                                                                    </el-tag>
                                                                    <el-tag type="info" v-show="exam.finalExam">期末测试
                                                                    </el-tag>
                                                                    <el-tag :type="getExamStatusType(exam.examStatus)"
                                                                        v-text="exam.examStatus">未发布</el-tag>
                                                                    <el-tag :type="getExamStatusType(exam.examStatus)"
                                                                        v-if="exam.examStudentStatus > 0"
                                                                        v-text="exam.examStudentStatus === 2 ? '已批改' : '未批改'">
                                                                    </el-tag>
                                                                    <!-- <span
                                                                        style="padding-left: 30px;font-size: 15px;color: #5F6368">限时：无</span> -->
                                                                    <span
                                                                        style="padding-left: 30px;font-size: 15px;color: #5F6368">
                                                                        起止时间：<span v-text="exam.startTime">2020-11-09
                                                                            22:17</span> ~
                                                                        <span
                                                                            v-text="exam.endTime === null ? '无' : exam.endTime">2020-11-09
                                                                            23:17</span></span>
                                                                </div>
                                                            </el-col>
                                                            <el-col :span="10"
                                                                v-show="!user.isTeacher && (exam.examStatus === '已发布' || exam.examStatus === '已结束')">
                                                                <div class="homework-operation" style="float: right">
                                                                    <el-button type="primary" plain
                                                                        @click="location.href='answerPage.html?id=' + exam.id"
                                                                        v-show="exam.examStatus === '已发布' && exam.examStudentStatus === 0">
                                                                        开始答题
                                                                    </el-button>
                                                                    <el-button type="primary" plain
                                                                        @click="location.href = 'examDetail.html?id=' + exam.id"
                                                                        v-show="(exam.examStatus === '已发布' && exam.examStudentStatus === 1) || 
                                                                        (exam.examStatus === '已结束' && 2 > exam.examStudentStatus)">
                                                                        查看完成情况
                                                                    </el-button>
                                                                    <el-button type="success" plain
                                                                        @click="location.href = 'examDetail.html?id=' + exam.id"
                                                                        v-show="exam.examStudentStatus === 2">查看成绩
                                                                    </el-button>
                                                                </div>
                                                            </el-col>
                                                            <el-col :span="10" v-show="exam.examStatus === '未开始'">
                                                                <span
                                                                    style="color: #FF6E48;font-size: 16px;font-weight: bold;float: right">开始时间
                                                                    <span v-text="exam.startTime">2020-11-14
                                                                        24:10</span>
                                                                </span>
                                                            </el-col>
                                                        </el-row>
                                                        <el-row id="course-announce"
                                                            style="height: 130px; margin-top: 10px;">
                                                            <el-col :span="12">
                                                                <el-row style="height: 55px;">
                                                                    <el-col :span="24">
                                                                        <el-link :underline="false"
                                                                            :href="'examPaper.html?id=' + exam.id"
                                                                            style="color: #3B3D45;font-size: 26px;float: left;padding-left: 30px;padding-top: 3px">
                                                                            <b v-text="exam.title">未发布_测试（考试）</b>
                                                                        </el-link>
                                                                    </el-col>
                                                                </el-row>
                                                                <el-row style="height: 75px">
                                                                    <el-col :span="24" style="height: 75px">
                                                                        <span style="float: left;padding-left: 30px">
                                                                            <span v-html="exam.introduction"
                                                                                style="font-size: 15px;color: #707070">
                                                                                description试卷描述
                                                                            </span>
                                                                        </span>
                                                                    </el-col>
                                                                </el-row>
                                                            </el-col>
                                                            <el-col :span="12">
                                                                <el-row>
                                                                    <el-col :span="12" style="float: right">
                                                                        <div class="homework-statics"
                                                                            style="height: 130px">
                                                                            <el-row
                                                                                v-show="exam.examStatus === '未发布' || exam.examStatus === '未开始'"
                                                                                style="height: 130px;padding-top: 15px">
                                                                            </el-row>
                                                                            <el-row
                                                                                v-show="user.isTeacher && (exam.examStatus === '已发布' || exam.examStatus === '已结束')"
                                                                                style="height: 130px;padding-top: 15px">
                                                                                <el-col :span="8">
                                                                                    <ul style="list-style: none">
                                                                                        <li
                                                                                            style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                            已批</li>
                                                                                        <li>
                                                                                            <el-link :underline="false"
                                                                                                v-text="exam.correctedCount"
                                                                                                style="font-size: 30px;color: #32BAF2;font-weight: bold">
                                                                                                15</el-link>
                                                                                        </li>
                                                                                    </ul>
                                                                                </el-col>
                                                                                <el-col :span="8">
                                                                                    <ul style="list-style: none">
                                                                                        <li
                                                                                            style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                            未批</li>
                                                                                        <li>
                                                                                            <el-link :underline="false"
                                                                                                v-text="exam.uncorrectedCount"
                                                                                                style="font-size: 30px;color: #707070;font-weight: bold">
                                                                                                4</el-link>
                                                                                        </li>
                                                                                    </ul>
                                                                                </el-col>
                                                                                <el-col :span="8">
                                                                                    <ul style="list-style: none">
                                                                                        <li
                                                                                            style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                            未交</li>
                                                                                        <li>
                                                                                            <el-link :underline="false"
                                                                                                v-text="exam.uncommittedCount"
                                                                                                style="font-size: 30px;color: #FF6000;font-weight: bold">
                                                                                                5</el-link>
                                                                                        </li>
                                                                                    </ul>
                                                                                </el-col>
                                                                            </el-row>
                                                                        </div>
                                                                    </el-col>
                                                                </el-row>
                                                            </el-col>
                                                        </el-row>
                                                        <el-row id="course-message" style="height: 60px">
                                                            <el-row>
                                                                <el-col :span="12" style="height: 50px">
                                                                    <span
                                                                        style="font-size: 15px;color: #A0A0A0;float: left;padding-left: 30px;padding-top: 10px;padding-bottom: 10px">
                                                                        创建于 <span v-text="exam.createTime">2020-11-09
                                                                            22:17</span>
                                                                    </span>
                                                                </el-col>
                                                                <el-col :span="12" v-show="user.isTeacher">
                                                                    <div class="exam-finished-buttons"
                                                                        style="float: right">
                                                                        <el-popconfirm confirmButtonText="确认"
                                                                            cancelButtonText="取消"
                                                                            confirmButtonType="danger"
                                                                            cancelButtonType="success" placement="top"
                                                                            @onConfirm="updateStatus(exam.id, 0)"
                                                                            title="确认考试时间、试题等编辑无误后即可发布，确认要发布此测试吗？">
                                                                            <el-button type="danger" plain
                                                                                slot="reference"
                                                                                v-show="exam.examStatus === '未发布'">立即发布
                                                                            </el-button>
                                                                        </el-popconfirm>
                                                                        <el-popconfirm confirmButtonText="确认"
                                                                            cancelButtonText="取消"
                                                                            confirmButtonType="danger"
                                                                            cancelButtonType="success" placement="top"
                                                                            @onConfirm="updateStatus(exam.id, 1)"
                                                                            title="确认要重新发布此测试吗？">
                                                                            <el-button type="primary" plain
                                                                                slot="reference"
                                                                                v-show="exam.examStatus === '已结束'">重新发布
                                                                            </el-button>
                                                                        </el-popconfirm>
                                                                        <el-popconfirm confirmButtonText="确认"
                                                                            cancelButtonText="取消"
                                                                            confirmButtonType="warning" plain
                                                                            cancelButtonType="success" placement="top"
                                                                            @onConfirm="updateStatus(exam.id, 2)"
                                                                            title="确认要取消发布此测试吗？">
                                                                            <el-button type="warning" plain
                                                                                slot="reference"
                                                                                v-show="exam.examStatus === '未开始'">取消发布
                                                                            </el-button>
                                                                        </el-popconfirm>
                                                                        <el-popconfirm confirmButtonText="确认"
                                                                            cancelButtonText="取消"
                                                                            confirmButtonType="warning" plain
                                                                            cancelButtonType="success" placement="top"
                                                                            @onConfirm="updateStatus(exam.id, 3)"
                                                                            title="确认要结束发布此测试吗？">
                                                                            <el-button type="success" plain
                                                                                slot="reference"
                                                                                v-show="exam.examStatus === '已发布'">结束发布
                                                                            </el-button>
                                                                        </el-popconfirm>
                                                                        <el-button type="primary" plain
                                                                            @click="showEditExamForm(exam.id)">
                                                                            编辑基本信息
                                                                        </el-button>
                                                                        <el-button type="primary" plain
                                                                            @click="location.href = 'examPaper.html?id=' + exam.id">
                                                                            编辑试题内容
                                                                        </el-button>
                                                                        <el-dropdown>
                                                                            <el-button type="primary">
                                                                                更多<i
                                                                                    class="el-icon-arrow-down el-icon--right"></i>
                                                                            </el-button>
                                                                            <el-dropdown-menu slot="dropdown">
                                                                                <!-- <el-dropdown-item>保存到备课区
                                                                                </el-dropdown-item>
                                                                                <el-dropdown-item>分享试卷给同事
                                                                                </el-dropdown-item> -->
                                                                                <el-dropdown-item>
                                                                                    <el-link v-show="exam.topNum === 0"
                                                                                        :underline="false"
                                                                                        @click="switchExamTop(exam.id)">
                                                                                        置顶</el-link>
                                                                                    <el-link v-show="exam.topNum > 0"
                                                                                        :underline="false"
                                                                                        @click="switchExamTop(exam.id)">
                                                                                        取消置顶</el-link>
                                                                                </el-dropdown-item>
                                                                                <el-dropdown-item>
                                                                                    <el-popconfirm
                                                                                        confirmButtonText="确认"
                                                                                        cancelButtonText="取消"
                                                                                        confirmButtonType="danger"
                                                                                        cancelButtonType="success"
                                                                                        placement="top"
                                                                                        @onConfirm="deleteExam(exam.id)"
                                                                                        title="确认要删除此测试吗？">
                                                                                        <el-link slot="reference"
                                                                                            :underline="false">删除
                                                                                        </el-link>
                                                                            </el-dropdown-menu>
                                                                        </el-dropdown>
                                                                    </div>
                                                                </el-col>
                                                            </el-row>
                                                        </el-row>
                                                    </el-card>

                                                    <el-card class="box-card" v-if="examList.length === 0"
                                                        style="margin-top: 20px;width: 1184px;height: 220px;border-radius: 6px;border-width: 2px">
                                                        <el-row>
                                                            <p
                                                                style="text-align: center; font-size: 15px; color: black; line-height: 160px;">
                                                                该课程暂无测试（考试）</p>
                                                        </el-row>
                                                    </el-card>
                                                </div>
                                            </el-tab-pane>
                                            <!-- 未发布 -->
                                            <el-tab-pane v-if="user.isTeacher"
                                                :label="'未发布(' + unreleasedExamList.length + ')'" name="second">
                                                <el-card class="box-card"
                                                    v-for="(unreleasedExam, index) in unreleasedExamList"
                                                    style="margin-top: 20px;width: 1184px;height: 230px;border-radius: 6px;border-width: 2px">
                                                    <el-row id="course-title" style="height: 30px">
                                                        <el-col :span="14">
                                                            <div class="homework-create-time" style="float: left">
                                                                <el-tag type="info" v-show="unreleasedExam.topNum > 0">
                                                                    置顶</el-tag>
                                                                <el-tag type="danger">未发布</el-tag>
                                                                <!-- <span
                                                                        style="padding-left: 30px;font-size: 15px;color: #5F6368">限时：无</span> -->
                                                                <span
                                                                    style="padding-left: 30px;font-size: 15px;color: #5F6368">
                                                                    起止时间：<span
                                                                        v-text="unreleasedExam.startTime">2020-11-09
                                                                        22:17</span> ~
                                                                    <span
                                                                        v-text="unreleasedExam.endTime === null ? '无' : unreleasedExam.endTime">2020-11-09
                                                                        23:17</span></span>
                                                            </div>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row id="course-announce"
                                                        style="height: 130px; margin-top: 10px;">
                                                        <el-col :span="12">
                                                            <el-row style="height: 55px">
                                                                <el-col :span="24">
                                                                    <el-link :underline="false"
                                                                        style="color: #3B3D45;font-size: 26px;float: left;padding-left: 30px;padding-top: 3px">
                                                                        <b v-text="unreleasedExam.title">未发布_测试（考试）</b>
                                                                    </el-link>
                                                                </el-col>
                                                            </el-row>
                                                            <el-row style="height: 75px">
                                                                <el-col :span="24" style="height: 75px">
                                                                    <span style="float: left;padding-left: 30px">
                                                                        <span v-html="unreleasedExam.introduction"
                                                                            style="font-size: 15px;color: #707070">
                                                                            description试卷描述
                                                                        </span>
                                                                    </span>
                                                                </el-col>
                                                            </el-row>
                                                        </el-col>
                                                        <el-col :span="12">
                                                            <el-row>
                                                                <el-col :span="12" style="float: right">
                                                                    <div class="homework-statics" style="height: 130px">
                                                                        <el-row style="height: 130px;padding-top: 15px">
                                                                        </el-row>
                                                                    </div>
                                                                </el-col>
                                                            </el-row>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row id="course-message" style="height: 60px">
                                                        <el-row>
                                                            <el-col :span="12" style="height: 50px">
                                                                <span
                                                                    style="font-size: 15px;color: #A0A0A0;float: left;padding-left: 30px;padding-top: 10px;padding-bottom: 10px">
                                                                    创建于 <span
                                                                        v-text="unreleasedExam.createTime">2020-11-09
                                                                        22:17</span>
                                                                </span>
                                                            </el-col>
                                                            <el-col :span="12">
                                                                <div class="exam-finished-buttons" style="float: right">
                                                                    <el-popconfirm confirmButtonText="确认"
                                                                        cancelButtonText="取消" confirmButtonType="danger"
                                                                        cancelButtonType="success" placement="top"
                                                                        @onConfirm="updateStatus(unreleasedExam.id, 0)"
                                                                        title="确认考试时间、试题等编辑无误后即可发布，确认要发布此测试吗？">
                                                                        <el-button type="danger" plain slot="reference">
                                                                            立即发布
                                                                        </el-button>
                                                                    </el-popconfirm>
                                                                    <el-button type="primary" plain
                                                                        @click="showEditExamForm(unreleasedExam.id)">
                                                                        编辑基本信息
                                                                    </el-button>
                                                                    <el-button type="primary" plain
                                                                        @click="location.href = 'examPaper.html?id=' + unreleasedExam.id">
                                                                        编辑试题内容
                                                                    </el-button>
                                                                    <el-dropdown>
                                                                        <el-button type="primary">
                                                                            更多<i
                                                                                class="el-icon-arrow-down el-icon--right"></i>
                                                                        </el-button>
                                                                        <el-dropdown-menu slot="dropdown">
                                                                            <!-- <el-dropdown-item>保存到备课区
                                                                                </el-dropdown-item>
                                                                                <el-dropdown-item>分享试卷给同事
                                                                                </el-dropdown-item> -->
                                                                            <el-dropdown-item>
                                                                                <el-link
                                                                                    v-show="unreleasedExam.topNum === 0"
                                                                                    :underline="false"
                                                                                    @click="switchExamTop(unreleasedExam.id)">
                                                                                    置顶</el-link>
                                                                                <el-link
                                                                                    v-show="unreleasedExam.topNum > 0"
                                                                                    :underline="false"
                                                                                    @click="switchExamTop(unreleasedExam.id)">
                                                                                    取消置顶</el-link>
                                                                            </el-dropdown-item>
                                                                            <el-dropdown-item>
                                                                                <el-link
                                                                                    @click="deleteExam(unreleasedExam.id)">
                                                                                    删除</el-link>
                                                                            </el-dropdown-item>
                                                                        </el-dropdown-menu>
                                                                    </el-dropdown>
                                                                </div>
                                                            </el-col>
                                                        </el-row>
                                                    </el-row>
                                                </el-card>
                                            </el-tab-pane>
                                            <!-- 未开始 -->
                                            <el-tab-pane v-if="user.isTeacher"
                                                :label="'未开始('+ unstartedExamList.length +')'" name="third">
                                                <el-card class="box-card"
                                                    v-for="(unstartedExam, index) in unstartedExamList" :key="index"
                                                    style="margin-top: 30px;width: 1184px;height: 230px;border-radius: 6px;border-width: 2px">
                                                    <el-row id="course-title" style="height: 30px">
                                                        <el-col :span="14">
                                                            <div class="homework-create-time" style="float: left">
                                                                <el-tag v-show="unstartedExam.topNum > 0" type="info">置顶
                                                                </el-tag>
                                                                <el-tag type="warning">未开始</el-tag>
                                                                <!-- <span
                                                                    style="padding-left: 30px;font-size: 15px;color: #5F6368">限时：无</span> -->
                                                                <span
                                                                    style="padding-left: 30px;font-size: 15px;color: #5F6368">起止时间：<span
                                                                        v-text="unstartedExam.startTime">2020-11-09
                                                                        22:17</span> ~
                                                                    <span
                                                                        v-text="unstartedExam.endTime === null ? '无' : unstartedExam.endTime">2020-11-09
                                                                        23:17</span></span>
                                                            </div>
                                                        </el-col>
                                                        <el-col :span="10">
                                                            <span
                                                                style="color: #FF6E48;font-size: 16px;font-weight: bold;float: right">开始时间
                                                                <span v-text="unstartedExam.startTime">2020-11-14
                                                                    24:10</span></span>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row id="course-announce"
                                                        style="height: 130px; margin-top: 10px;">
                                                        <el-col :span="12">
                                                            <el-row style="height: 55px">
                                                                <el-col :span="24">
                                                                    <el-link :underline="false"
                                                                        style="color: #3B3D45;font-size: 26px;float: left;padding-left: 30px;padding-top: 3px">
                                                                        <b v-text="unstartedExam.title">未开始_测试（考试）</b>
                                                                    </el-link>
                                                                </el-col>
                                                            </el-row>
                                                            <el-row style="height: 75px">
                                                                <el-col :span="24" style="height: 75px">
                                                                    <span style="float: left;padding-left: 30px">
                                                                        <span style="font-size: 15px;color: #707070"
                                                                            v-html="unstartedExam.introduction">
                                                                            description试卷描述
                                                                        </span>
                                                                    </span>
                                                                </el-col>
                                                            </el-row>
                                                        </el-col>
                                                        <el-col :span="12">
                                                            <el-row>
                                                                <el-col :span="12" style="float: right">
                                                                    <div class="homework-statics" style="height: 130px">
                                                                        <el-row style="height: 130px;padding-top: 15px">
                                                                        </el-row>
                                                                    </div>
                                                                </el-col>
                                                            </el-row>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row id="course-message" style="height: 60px">
                                                        <el-row>
                                                            <el-col :span="12" style="height: 50px">
                                                                <span
                                                                    style="font-size: 15px;color: #A0A0A0;float: left;padding-left: 30px;padding-top: 10px;padding-bottom: 10px">
                                                                    创建于 <span
                                                                        v-text="unstartedExam.createTime">2020-11-09
                                                                        22:17</span>
                                                                </span>
                                                            </el-col>
                                                            <el-col :span="12">
                                                                <div class="exam-finished-buttons" style="float: right">
                                                                    <el-popconfirm confirmButtonText="确认"
                                                                        cancelButtonText="取消"
                                                                        confirmButtonType="warning" plain
                                                                        cancelButtonType="success" placement="top"
                                                                        @onConfirm="updateStatus(unstartedExam.id, 2)"
                                                                        title="确认要取消发布此测试吗？">
                                                                        <el-button type="warning" plain
                                                                            slot="reference">取消发布
                                                                        </el-button>
                                                                    </el-popconfirm>
                                                                    <el-button type="primary" plain
                                                                        @click="showEditExamForm(unstartedExam.id)">
                                                                        编辑基本信息
                                                                    </el-button>
                                                                    <el-button type="primary" plain
                                                                        @click="location.href = 'examPaper.html?id=' + unstartedExam.id">
                                                                        编辑试题内容
                                                                    </el-button>
                                                                    <el-dropdown>
                                                                        <el-button type="primary">
                                                                            更多<i
                                                                                class="el-icon-arrow-down el-icon--right"></i>
                                                                        </el-button>
                                                                        <el-dropdown-menu slot="dropdown">
                                                                            <!-- <el-dropdown-item>保存到备课区
                                                                                </el-dropdown-item>
                                                                                <el-dropdown-item>分享试卷给同事
                                                                                </el-dropdown-item> -->
                                                                            <el-dropdown-item>
                                                                                <el-link
                                                                                    v-show="unstartedExam.topNum === 0"
                                                                                    :underline="false"
                                                                                    @click="switchExamTop(unstartedExam.id)">
                                                                                    置顶</el-link>
                                                                                <el-link
                                                                                    v-show="unstartedExam.topNum > 0"
                                                                                    :underline="false"
                                                                                    @click="switchExamTop(unstartedExam.id)">
                                                                                    取消置顶</el-link>
                                                                            </el-dropdown-item>
                                                                            <el-dropdown-item>
                                                                                <el-popconfirm confirmButtonText="确认"
                                                                                    cancelButtonText="取消"
                                                                                    confirmButtonType="danger"
                                                                                    cancelButtonType="success"
                                                                                    placement="top"
                                                                                    @onConfirm="deleteExam(unstartedExam.id)"
                                                                                    title="确认要删除此测试吗？">
                                                                                    <el-link slot="reference"
                                                                                        :underline="false">删除
                                                                                    </el-link>
                                                                        </el-dropdown-menu>
                                                                    </el-dropdown>
                                                                </div>
                                                            </el-col>
                                                        </el-row>
                                                    </el-row>
                                                </el-card>
                                            </el-tab-pane>
                                            <!-- 已发布 -->
                                            <el-tab-pane v-if="user.isTeacher"
                                                :label="'已发布('+ releasedExamList.length +')'" name="fourth">
                                                <el-card class="box-card"
                                                    v-for="(releasedExam, index) in releasedExamList" :key="index"
                                                    style="margin-top: 30px;width: 1184px;height: 230px;border-radius: 6px;border-width: 2px">
                                                    <el-row id="course-title" style="height: 30px">
                                                        <el-col :span="14">
                                                            <div class="homework-create-time" style="float: left">
                                                                <el-tag type="info" v-show="releasedExam.topNum > 0">置顶
                                                                </el-tag>
                                                                <el-tag type="success">已发布</el-tag>
                                                                <!-- <span
                                                                    style="padding-left: 30px;font-size: 15px;color: #5F6368">限时：无</span> -->
                                                                <span
                                                                    style="padding-left: 30px;font-size: 15px;color: #5F6368">起止时间：<span
                                                                        v-text="releasedExam.startTime">2020-11-09
                                                                        22:17</span> ~
                                                                    <span
                                                                        v-text="releasedExam.endTime === null ? '无' : releasedExam.endTime">2020-11-09
                                                                        23:17</span></span>
                                                            </div>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row id="course-announce"
                                                        style="height: 130px; margin-top: 10px;">
                                                        <el-col :span="12">
                                                            <el-row style="height: 55px">
                                                                <el-col :span="24">
                                                                    <el-link :underline="false"
                                                                        style="color: #3B3D45;font-size: 26px;float: left;padding-left: 30px;padding-top: 3px">
                                                                        <b v-text="releasedExam.title">已发布_测试（考试）</b>
                                                                    </el-link>
                                                                </el-col>
                                                            </el-row>
                                                            <el-row style="height: 75px">
                                                                <el-col :span="24" style="height: 75px">
                                                                    <span style="float: left;padding-left: 30px">
                                                                        <span style="font-size: 15px;color: #707070"
                                                                            v-html="releasedExam.introduction">
                                                                            description试卷描述
                                                                        </span>
                                                                    </span>
                                                                </el-col>
                                                            </el-row>
                                                        </el-col>
                                                        <el-col :span="12">
                                                            <el-row>
                                                                <el-col :span="12" style="float: right">
                                                                    <div class="homework-statics" style="height: 130px">
                                                                        <el-row v-show="user.isTeacher"
                                                                            style="height: 130px;padding-top: 15px">
                                                                            <el-col :span="8">
                                                                                <ul style="list-style: none">
                                                                                    <li
                                                                                        style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                        已批</li>
                                                                                    <li>
                                                                                        <el-link :underline="false"
                                                                                            v-text="releasedExam.correctedCount"
                                                                                            style="font-size: 30px;color: #32BAF2;font-weight: bold">
                                                                                            15</el-link>
                                                                                    </li>
                                                                                </ul>
                                                                            </el-col>
                                                                            <el-col :span="8">
                                                                                <ul style="list-style: none">
                                                                                    <li
                                                                                        style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                        未批</li>
                                                                                    <li>
                                                                                        <el-link :underline="false"
                                                                                            v-text="releasedExam.uncorrectedCount"
                                                                                            style="font-size: 30px;color: #707070;font-weight: bold">
                                                                                            4</el-link>
                                                                                    </li>
                                                                                </ul>
                                                                            </el-col>
                                                                            <el-col :span="8">
                                                                                <ul style="list-style: none">
                                                                                    <li
                                                                                        style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                        未交</li>
                                                                                    <li>
                                                                                        <el-link :underline="false"
                                                                                            v-text="releasedExam.uncommittedCount"
                                                                                            style="font-size: 30px;color: #FF6000;font-weight: bold">
                                                                                            5</el-link>
                                                                                    </li>
                                                                                </ul>
                                                                            </el-col>
                                                                        </el-row>
                                                                    </div>
                                                                </el-col>
                                                            </el-row>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row id="course-message" style="height: 60px">
                                                        <el-row>
                                                            <el-col :span="12" style="height: 50px">
                                                                <span
                                                                    style="font-size: 15px;color: #A0A0A0;float: left;padding-left: 30px;padding-top: 10px;padding-bottom: 10px">
                                                                    创建于 <span
                                                                        v-text="releasedExam.createTime">2020-11-09
                                                                        22:17</span>
                                                                </span>
                                                            </el-col>
                                                            <el-col :span="12">
                                                                <div class="exam-finished-buttons" style="float: right">
                                                                    <el-popconfirm confirmButtonText="确认"
                                                                        cancelButtonText="取消"
                                                                        confirmButtonType="warning" plain
                                                                        cancelButtonType="success" placement="top"
                                                                        @onConfirm="updateStatus(releasedExam.id, 3)"
                                                                        title="确认要结束发布此测试吗？">
                                                                        <el-button type="success" plain
                                                                            slot="reference">结束发布
                                                                        </el-button>
                                                                    </el-popconfirm>
                                                                    <el-button type="primary" plain
                                                                        @click="showEditExamForm(releasedExam.id)">
                                                                        编辑基本信息
                                                                    </el-button>
                                                                    <el-button type="primary" plain
                                                                        @click="location.href = 'examPaper.html?id=' + releasedExam.id">
                                                                        编辑试题内容
                                                                    </el-button>
                                                                    <el-dropdown>
                                                                        <el-button type="primary">
                                                                            更多<i
                                                                                class="el-icon-arrow-down el-icon--right"></i>
                                                                        </el-button>
                                                                        <el-dropdown-menu slot="dropdown">
                                                                            <!-- <el-dropdown-item>保存到备课区
                                                                                </el-dropdown-item>
                                                                                <el-dropdown-item>分享试卷给同事
                                                                                </el-dropdown-item> -->
                                                                            <el-dropdown-item>
                                                                                <el-link
                                                                                    v-show="releasedExam.topNum === 0"
                                                                                    :underline="false"
                                                                                    @click="switchExamTop(releasedExam.id)">
                                                                                    置顶</el-link>
                                                                                <el-link
                                                                                    v-show="releasedExam.topNum > 0"
                                                                                    :underline="false"
                                                                                    @click="switchExamTop(releasedExam.id)">
                                                                                    取消置顶</el-link>
                                                                            </el-dropdown-item>
                                                                            <el-dropdown-item>
                                                                                <el-popconfirm confirmButtonText="确认"
                                                                                    cancelButtonText="取消"
                                                                                    confirmButtonType="danger"
                                                                                    cancelButtonType="success"
                                                                                    placement="top"
                                                                                    @onConfirm="deleteExam(releasedExam.id)"
                                                                                    title="确认要删除此测试吗？">
                                                                                    <el-link slot="reference"
                                                                                        :underline="false">删除
                                                                                    </el-link>
                                                                        </el-dropdown-menu>
                                                                    </el-dropdown>
                                                                </div>
                                                            </el-col>
                                                        </el-row>
                                                    </el-row>
                                                </el-card>
                                            </el-tab-pane>
                                            <!-- 已结束 -->
                                            <el-tab-pane v-if="user.isTeacher"
                                                :label="'已结束(' + endedExamList.length + ')'" name="fifth">
                                                <el-card class="box-card" v-for="(endedExam, index) in endedExamList"
                                                    :key="index"
                                                    style="margin-top: 30px;width: 1184px;height: 230px;border-radius: 6px;border-width: 2px">
                                                    <el-row id="course-title" style="height: 30px">
                                                        <el-col :span="14">
                                                            <div class="homework-create-time" style="float: left">
                                                                <el-tag type="info" v-show="endedExam.topNum > 0">置顶
                                                                </el-tag>
                                                                <el-tag>已结束</el-tag>
                                                                <!-- <span
                                                                    style="padding-left: 30px;font-size: 15px;color: #5F6368">限时：无</span> -->
                                                                <span
                                                                    style="padding-left: 30px;font-size: 15px;color: #5F6368">起止时间：<span
                                                                        v-text="endedExam.startTime">2020-11-09
                                                                        22:17</span> ~
                                                                    <span
                                                                        v-text="endedExam.endTime === null ? '无' : endedExam.endTime">2020-11-09
                                                                        23:17</span></span>
                                                            </div>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row id="course-announce"
                                                        style="height: 130px; margin-top: 10px;">
                                                        <el-col :span="12">
                                                            <el-row style="height: 55px">
                                                                <el-col :span="24">
                                                                    <el-link :underline="false"
                                                                        style="color: #3B3D45;font-size: 26px;float: left;padding-left: 30px;padding-top: 3px">
                                                                        <b v-text="endedExam.title">已结束_测试（考试）</b>
                                                                    </el-link>
                                                                </el-col>
                                                            </el-row>
                                                            <el-row style="height: 75px">
                                                                <el-col :span="24" style="height: 75px">
                                                                    <span style="float: left;padding-left: 30px">
                                                                        <span style="font-size: 15px;color: #707070"
                                                                            v-html="endedExam.introduction">
                                                                            description试卷描述
                                                                        </span>
                                                                    </span>
                                                                </el-col>
                                                            </el-row>
                                                        </el-col>
                                                        <el-col :span="12">
                                                            <el-row>
                                                                <el-col :span="12" style="float: right">
                                                                    <div class="homework-statics" style="height: 130px">
                                                                        <el-row v-show="user.isTeacher"
                                                                            style="height: 130px;padding-top: 15px">
                                                                            <el-col :span="8">
                                                                                <ul style="list-style: none">
                                                                                    <li
                                                                                        style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                        已批</li>
                                                                                    <li>
                                                                                        <el-link :underline="false"
                                                                                            v-text="endedExam.correctedCount"
                                                                                            style="font-size: 30px;color: #32BAF2;font-weight: bold">
                                                                                            15</el-link>
                                                                                    </li>
                                                                                </ul>
                                                                            </el-col>
                                                                            <el-col :span="8">
                                                                                <ul style="list-style: none">
                                                                                    <li
                                                                                        style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                        未批</li>
                                                                                    <li>
                                                                                        <el-link :underline="false"
                                                                                            v-text="endedExam.uncorrectedCount"
                                                                                            style="font-size: 30px;color: #707070;font-weight: bold">
                                                                                            4</el-link>
                                                                                    </li>
                                                                                </ul>
                                                                            </el-col>
                                                                            <el-col :span="8">
                                                                                <ul style="list-style: none">
                                                                                    <li
                                                                                        style="font-size: 14px;color: #202124;font-weight: bold">
                                                                                        未交</li>
                                                                                    <li>
                                                                                        <el-link :underline="false"
                                                                                            v-text="endedExam.uncommittedCount"
                                                                                            style="font-size: 30px;color: #FF6000;font-weight: bold">
                                                                                            5</el-link>
                                                                                    </li>
                                                                                </ul>
                                                                            </el-col>
                                                                        </el-row>
                                                                    </div>
                                                                </el-col>
                                                            </el-row>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row id="course-message" style="height: 60px">
                                                        <el-row>
                                                            <el-col :span="12" style="height: 50px">
                                                                <span
                                                                    style="font-size: 15px;color: #A0A0A0;float: left;padding-left: 30px;padding-top: 10px;padding-bottom: 10px">
                                                                    创建于 <span v-text="endedExam.createTime">2020-11-09
                                                                        22:17</span>
                                                                </span>
                                                            </el-col>
                                                            <el-col :span="12">
                                                                <div class="exam-finished-buttons" style="float: right">
                                                                    <el-popconfirm confirmButtonText="确认"
                                                                        cancelButtonText="取消"
                                                                        confirmButtonType="warning" plain
                                                                        cancelButtonType="success" placement="top"
                                                                        @onConfirm="updateStatus(endedExam.id, 1)"
                                                                        title="确认要重新发布此测试吗？">
                                                                        <el-button type="primary" plain
                                                                            slot="reference">重新发布
                                                                        </el-button>
                                                                    </el-popconfirm>
                                                                    <el-button type="primary" plain
                                                                        @click="showEditExamForm(endedExam.id)">
                                                                        编辑基本信息
                                                                    </el-button>
                                                                    <el-button type="primary" plain
                                                                        @click="location.href = 'examPaper.html?id=' + endedExam.id">
                                                                        编辑试题内容
                                                                    </el-button>
                                                                    <el-dropdown>
                                                                        <el-button type="primary">
                                                                            更多<i
                                                                                class="el-icon-arrow-down el-icon--right"></i>
                                                                        </el-button>
                                                                        <el-dropdown-menu slot="dropdown">
                                                                            <!-- <el-dropdown-item>保存到备课区
                                                                            </el-dropdown-item>
                                                                            <el-dropdown-item>分享试卷给同事
                                                                            </el-dropdown-item> -->
                                                                            <el-dropdown-item>
                                                                                <el-link v-show="endedExam.topNum === 0"
                                                                                    :underline="false"
                                                                                    @click="switchExamTop(endedExam.id)">
                                                                                    置顶</el-link>
                                                                                <el-link v-show="endedExam.topNum > 0"
                                                                                    :underline="false"
                                                                                    @click="switchExamTop(endedExam.id)">
                                                                                    取消置顶</el-link>
                                                                            </el-dropdown-item>
                                                                            <el-dropdown-item>
                                                                                <el-popconfirm confirmButtonText="确认"
                                                                                    cancelButtonText="取消"
                                                                                    confirmButtonType="danger"
                                                                                    cancelButtonType="success"
                                                                                    placement="top"
                                                                                    @onConfirm="deleteExam(endedExam.id)"
                                                                                    title="确认要删除此测试吗？">
                                                                                    <el-link slot="reference"
                                                                                        :underline="false">删除
                                                                                    </el-link>
                                                                        </el-dropdown-menu>
                                                                    </el-dropdown>
                                                                </div>
                                                            </el-col>
                                                        </el-row>
                                                    </el-row>
                                                </el-card>
                                            </el-tab-pane>
                                        </el-tabs>
                                    </el-col>
                                </el-row>
                            </div>
                        </div>
                    </div>
                    <!-- 公告模块 -->
                    <div id="course-notice" v-if="activeIndex2=='4'">
                        <div id="course-notice-box">
                            <!-- 发布公告按钮 -->
                            <div id="notice-teacher" v-if="user.isTeacher">
                                <div id="notice-menubar"
                                    style="margin-top: 30px;padding-bottom: 30px;padding-left: 30px">
                                    <el-button type="primary" style="float: left" @click="showInputNoticeForm"
                                        :disabled="noticeFormVisible">发布公告</el-button>
                                </div>
                            </div>
                            <!-- 公告列表 -->
                            <div id="notice-cards" style="margin-top: 30px">
                                <el-card class="box-card" v-for="(notice, index) in noticeList" :key="index"
                                    v-if="noticeList.length > 0"
                                    style="margin-top: 20px;width: 1184px;height: 220px;border-radius: 6px;border-width: 2px">
                                    <el-row id="course-title" style="height: 30px">
                                        <el-col :span="12">
                                            <div class="homework-create-time" style="float: left">
                                                <el-tag v-show="notice.topNum != 0" size="medium" type="danger">置顶
                                                </el-tag>
                                                <span
                                                    style="padding-left: 30px;font-size: 15px;color: #A0A0A0">发布人：<span
                                                        v-text="notice.course.teacher.realName">CurtisCheng</span></span>
                                                <span
                                                    style="padding-left: 30px;font-size: 15px;color: #A0A0A0">发布时间：<span
                                                        v-text="notice.createTime">2020-11-09 22:17</span></span>
                                            </div>
                                        </el-col>
                                        <el-col :span="12" v-show="user.isTeacher">
                                            <div class="homework-operation" style="float: right">
                                                <el-dropdown>
                                                    <span class="el-dropdown-link">
                                                        操作 <i class="el-icon-more"></i>
                                                    </span>
                                                    <el-dropdown-menu slot="dropdown">
                                                        <el-dropdown-item>
                                                            <router-link @click="switchNoticeTop(notice.id)"
                                                                v-if="notice.topNum === 0">
                                                                置顶
                                                            </router-link>
                                                            <router-link @click="switchNoticeTop(notice.id)" v-else>
                                                                取消置顶
                                                            </router-link>
                                                        </el-dropdown-item>
                                                        <el-dropdown-item>
                                                            <router-link @click="showEditNoticeForm(notice.id)">编辑
                                                            </router-link>
                                                        </el-dropdown-item>
                                                        <!-- <el-popover placement="top" width="160"
                                                            v-model="delNoticeVisible">
                                                            <p>确认要删除此公告吗？</p>
                                                            <div style="text-align: right; margin: 0">
                                                                <el-button size="mini" type="text"
                                                                    @click="delNoticeVisible = false">取消</el-button>
                                                                <el-button type="primary" size="mini"
                                                                    @click="deleteNotice(notice.id)">确定</el-button>
                                                            </div>
                                                            <el-dropdown-item slot="reference">删除</el-dropdown-item>
                                                        </el-popover> -->
                                                        <el-popconfirm confirmButtonText="确认" cancelButtonText="取消"
                                                            confirmButtonType="danger" cancelButtonType="success"
                                                            placement="top" @onConfirm="deleteNotice(notice.id)"
                                                            title="确认要删除此公告吗？">
                                                            <el-dropdown-item slot="reference">删除</el-dropdown-item>
                                                        </el-popconfirm>
                                                    </el-dropdown-menu>
                                                </el-dropdown>
                                            </div>
                                        </el-col>
                                    </el-row>
                                    <el-row id="course-announce" style="height: 130px">
                                        <el-col :span="12">
                                            <el-row style="height: 75px">
                                                <el-col :span="24">
                                                    <el-link :underline="false"
                                                        style="font-size: 26px;float: left;padding-left: 30px;padding-top: 30px"
                                                        @click="location.href = 'noticeDetail.html?id=' + notice.id">
                                                        <span v-text="notice.title">范例_公告一</span>
                                                    </el-link>
                                                </el-col>
                                            </el-row>
                                            <el-row style="height: 55px">
                                                <el-col :span="24">
                                                    <span style="float: left;padding-left: 30px;padding-top: 5px">
                                                        <span style="font-size: 15px;color: #707070"
                                                            v-text="getSimpleText(notice.content)">如题所述</span>
                                                    </span>
                                                </el-col>
                                            </el-row>
                                        </el-col>
                                    </el-row>
                                    <el-row id="course-message" style="height: 60px">
                                        <el-row>
                                            <el-col style="height: 50px">
                                                <span
                                                    style="font-size: 15px;color: #A0A0A0;float: left;padding-left: 30px;padding-top: 0;padding-bottom: 10px">
                                                    <span v-text="notice.views">0</span> 人已读
                                                </span>
                                                <span
                                                    style="font-size: 15px;color: #A0A0A0;float: left;padding-left: 30px;padding-top: 0;padding-bottom: 10px">
                                                    <span v-text="notice.commentCount">0</span> 条评论
                                                </span>
                                            </el-col>
                                        </el-row>
                                    </el-row>
                                </el-card>

                                <el-card class="box-card" v-if="noticeList.length === 0"
                                    style="margin-top: 20px;width: 1184px;height: 220px;border-radius: 6px;border-width: 2px">
                                    <el-row>
                                        <p
                                            style="text-align: center; font-size: 15px; color: black; line-height: 160px;">
                                            该课程暂无公告</p>
                                    </el-row>
                                </el-card>
                            </div>
                        </div>
                    </div>
                </el-main>
            </el-container>

            <!-- 底部 -->
            <el-footer style="padding-top: 50px">
                <el-row type="flex" justify="center">
                    <el-col :span="8"></el-col>
                    <el-col :span="8" push="1">
                        <el-menu mode="horizontal">
                            <el-menu-item>关于我们</el-menu-item>
                            <el-menu-item>联系我们</el-menu-item>
                            <el-menu-item>服务条款</el-menu-item>
                            <el-menu-item>浏览器下载</el-menu-item>
                            <el-menu-item>更新动态</el-menu-item>
                        </el-menu>
                    </el-col>
                    <el-col :span="8"></el-col>
                </el-row>
                <span class="foot-text">Copyright © 2020 yixuetang.com All Rights Reserved. </span>
            </el-footer>
        </el-container>

        <!-- 发布/编辑作业表单 -->
        <el-dialog :title="isEditHomework ? '编辑' + '作业' : '发布' + '作业'" :visible.sync="homeworkFormVisible"
            @opened="initHomeworkEditor()" @closed="destroyHomeworkEditor">
            <el-form :model="homeworkForm" :rules="homeworkRule" ref="inputOrEditHomeworkForm">
                <el-form-item prop="title">
                    <el-input placeholder="作业名称" v-model="homeworkForm.title" clearable>
                    </el-input>
                </el-form-item>
                <el-form-item>
                    <div id="homeworkEditor"></div>
                </el-form-item>
                <el-form-item prop="deadline">
                    <div class="block" style="float: left">
                        <span class="demonstration">截止日期：</span>
                        <el-date-picker v-model="homeworkForm.deadline" type="datetime" placeholder="选择日期时间"
                            align="right" :picker-options="pickerOptions">
                        </el-date-picker>
                    </div>
                </el-form-item>
                <el-form-item prop="totalScore">
                    <div class="block" style="float: left;">
                        <span class="demonstration">满&ensp;分&ensp;值：</span>
                        <el-input-number v-model="homeworkForm.totalScore" :min="1" :step="0.5" :max="100" label="分值">
                        </el-input-number>
                    </div>
                </el-form-item>
                <el-form-item>
                    <div id="homework-button" style="float: right;">
                        <el-button type="primary" plain @click="homeworkFormVisible=false">取消</el-button>
                        <el-button type="primary"
                            @click="isEditHomework ? editHomework('inputOrEditHomeworkForm') : inputHomework('inputOrEditHomeworkForm')">
                            确定
                        </el-button>
                    </div>
                </el-form-item>
            </el-form>
        </el-dialog>

        <!-- 发布/编辑公告表单 -->
        <el-dialog :title="isEditNotice ? '编辑公告' : '发布公告'" :visible.sync="noticeFormVisible"
            @opened="initNoticeEditor()" @closed="destroyNoticeEditor()" destroy-on-close>
            <el-form :model="noticeForm" :rules="noticeRule" ref="inputOrEditNoticeForm">
                <el-form-item prop="title">
                    <el-input placeholder="请输入公告标题" v-model="noticeForm.title" clearable>
                    </el-input>
                </el-form-item>
                <el-form-item>
                    <div id="noticeEditor"></div>
                </el-form-item>
                <el-form-item>
                    <div id="notice-button" style="float: right;padding-top: 10px">
                        <el-button type="primary" plain @click="noticeFormVisible = false">取消
                        </el-button>
                        <el-button type="primary"
                            @click="isEditNotice ? editNotice('inputOrEditNoticeForm') : inputNotice('inputOrEditNoticeForm')">
                            确定
                        </el-button>
                    </div>
                </el-form-item>
            </el-form>
        </el-dialog>

        <!-- 新建/编辑测试（考试）基本信息表单 -->
        <el-dialog :title="isEditExam ? '编辑测试（考试）基本信息' : '新建测试（考试）基本信息'" :visible.sync="examFormVisible"
            @opened="initExamEditor()" @closed="destroyExamEditor()" destroy-on-close>
            <el-form :model="examForm" :rules="examRule" ref="inputOrEditExamForm">
                <el-form-item prop="title">
                    <el-input placeholder="请输入测试（考试）标题" v-model="examForm.title" clearable>
                    </el-input>
                </el-form-item>
                <el-form-item>
                    <div id="examEditor"></div>
                </el-form-item>
                <el-form-item prop="startTime">
                    <el-date-picker v-model="examForm.startTime" type="datetime" placeholder="考试开始时间">
                    </el-date-picker>
                </el-form-item>
                <el-form-item>
                    <el-date-picker v-model="examForm.endTime" type="datetime" placeholder="考试结束时间">
                    </el-date-picker>
                </el-form-item>
                <el-form-item label="是否为期末测试">
                    <el-switch v-model="examForm.finalExam" active-color="#13ce66"></el-switch>
                </el-form-item>
                <el-form-item>
                    <div id="notice-button" style="float: right;padding-top: 10px">
                        <el-button type="primary" plain @click="examFormVisible = false">取消
                        </el-button>
                        <el-button type="primary"
                            @click="isEditExam ? editExam('inputOrEditExamForm') : inputExam('inputOrEditExamForm')">
                            确定
                        </el-button>
                    </div>
                </el-form-item>
            </el-form>
        </el-dialog>

    </div>
</body>
<script src="https://cdn.bootcss.com/vue/2.6.11/vue.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.19.2/axios.min.js"></script>
<!-- <script src="https://cdn.bootcss.com/element-ui/2.13.2/index.js"></script> -->
<script src="./js/index.js"></script>
<script src="js/md5.js"></script>
<script src="js/common.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/wangeditor@4.5.0/dist/wangEditor.min.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            activeIndex: '1',
            activeIndex2: '1',
            activeName: 'first',
            user: {
                id: -1,
                username: "",
                isTeacher: "",
                avatar: "",
                rememberMe: "",
            },
            course: {
                id: 3,
                createTime: "2020-10-30 09:35:28",
                updateTime: "2020-11-03 16:48:10",
                schoolYear: "2019-2020",
                semester: "第一学期",
                clazz: "17网工5班",
                topNum: 0,
                isFiled: false,
                teacher: {
                    id: 2,
                    username: "CurtisT",
                    realName: "郑咏昌",
                    gender: "男",
                    age: 22,
                    email: "CurtisCheng992@163.com",
                    avatar: "http://www.pava.run/group1/M00/00/00/rBAABV-jW1qALEibAAGxb3lI0NI550.jpg",
                    phone: "15625110149",
                    school: "佛山科学技术学院",
                    tsNo: "2017039051T",
                    createTime: "2020-10-27 19:29:36",
                    updateTime: "2020-11-11 09:32:09",
                    role: {
                        id: 2,
                        rname: "老师/助教",
                    },
                },
                scount: 1,
                ccode: "wwqwer",
                cpic: "https://assets.ketangpai.com/theme/student/min/22.png",
                cname: "数据结构",
            },
            breadcrumb: '<button type="button" class="el-button el-button--text" onclick="getResourceData(' + yxt.getUrlParam("id") + ', ' + -1 + ')">所有文件</button>',
            homeworkList: [],
            homeworkEditor: null,
            homeworkDeadline: null, // 记录用户编辑作业时是否修改了 deadline
            homeworkForm: {
                title: "",
                description: "",
                deadline: null,
                totalScore: 100,
            },
            homeworkFormVisible: false,
            isEditHomework: false,
            noticeEditor: null,
            isEditNotice: false,
            noticeFormVisible: false,
            noticeForm: {
                title: "",
                content: "",
            },
            unreleasedExamList: [],
            unstartedExamList: [],
            releasedExamList: [],
            endedExamList: [],
            examList: [],
            examEditor: null,
            isEditExam: false,
            examFormVisible: false,
            examForm: {},
            resourceForm: {},
            updateCourseForm: {
                clazz: "",
                cname: "",
                schoolYear: "",
                semester: "",
            },
            pickerOptions: {
                shortcuts: [{
                    text: '40分钟后',
                    onClick(picker) {
                        const date = new Date();
                        date.setTime(date.getTime() + 2400 * 1000);
                        picker.$emit('pick', date);
                    }
                }, {
                    text: '1小时后',
                    onClick(picker) {
                        const date = new Date();
                        date.setTime(date.getTime() + 3600 * 1000);
                        picker.$emit('pick', date);
                    }
                }, {
                    text: '2小时后',
                    onClick(picker) {
                        const date = new Date();
                        date.setTime(date.getTime() + 3600 * 1000 * 2);
                        picker.$emit('pick', date);
                    }
                }, {
                    text: '12小时后',
                    onClick(picker) {
                        const date = new Date();
                        date.setTime(date.getTime() + 3600 * 1000 * 12);
                        picker.$emit('pick', date);
                    }
                }, {
                    text: '明天',
                    onClick(picker) {
                        const date = new Date();
                        date.setTime(date.getTime() + 3600 * 1000 * 24);
                        picker.$emit('pick', date);
                    }
                }, {
                    text: '后天',
                    onClick(picker) {
                        const date = new Date();
                        date.setTime(date.getTime() + 3600 * 1000 * 24 * 2);
                        picker.$emit('pick', date);
                    }
                }, {
                    text: '一周后',
                    onClick(picker) {
                        const date = new Date();
                        date.setTime(date.getTime() + 3600 * 1000 * 24 * 7);
                        picker.$emit('pick', date);
                    }
                }]
            },
            homeworkRule: {
                title: [{ required: true, message: '请输入作业名称', trigger: 'blur' }],
                deadline: [{ required: true, message: '请输入截止日期', trigger: 'blur' }],
                totalScore: [{ required: true, message: '请输入满分值', trigger: 'blur' }],
            },
            noticeRule: {
                title: [{ required: true, message: '请输入公告标题', trigger: 'blur' }],
            },
            examRule: {
                title: [{ required: true, message: '请输入测试（考试）标题', trigger: 'blur' }],
                startTime: [{ required: true, message: '请输入考试开始时间', trigger: 'blur' }]
            },
            resourceRule: {
                name: [{ required: true, message: '请输入资源名称', trigger: 'blur' }],
            },
            homeworkCount: 1,
            resourceCount: 2,
            examCount: 4,
            noticeCount: 3,
            cname: "",
            isProgressVisable: false,
            progressPercent: 0,
            notice_input: false,
            notice_edit: false,
            dialogUpdateCourseFormVisible: false,
            createFolderFormVisible: false,
            formLabelWidth: '120px',
            noticeList: [],
            resourceList: [],
            resourceAncestors: [],
            parentResourceId: -1,
            unreadMessageCount: {},
            showDownloadResourceId: -1,
            delResourceVisible: false,
            resourceManageDialogVisible: false,
            courseResourceList: [],
            myProps: {
                children: 'childResourceList',
                label: 'name'
            },
            renameResourceFormVisible: false,
            studentHomework: {}
        },
        methods: {
            initHomeworkEditor() {
                const editor = new wangEditor(`#homeworkEditor`)
                // 配置 onchange 回调函数，将数据同步到 vue 中
                editor.config.onchange = (newHtml) => {
                    this.homeworkForm.description = newHtml
                }
                // 配置菜单
                editor.config.menus = [
                    'bold',
                    'underline',
                    'italic',
                    'strikeThrough',
                    'quote',
                    'foreColor',
                    'backColor',
                    'fontSize',
                    'fontName',
                    'justify',
                    'code',
                    'image',
                    'video',
                    'indent',
                    'lineHeight',
                    'link',
                    'list',
                    'emoticon',
                    'table',
                    'undo',
                    'redo'
                ]
                // 配置 placeholder
                editor.config.placeholder = '作业简介，作业格式等要求'
                // 配置 server 上传图片接口地址
                editor.config.uploadImgServer = 'http://api.yixuetang.com/api/resource/upload/editor/userId/' + this.user.id
                // 配置上传文件参数名
                editor.config.uploadFileName = 'file';
                // 创建编辑器
                editor.create()
                this.homeworkEditor = editor

                // 如果是编辑已发布的作业，需要回显数据
                if (this.isEditHomework) {
                    this.homeworkEditor.txt.html(this.homeworkForm.description);
                }
            },
            initNoticeEditor() {
                const editor = new wangEditor(`#noticeEditor`)
                // 配置 onchange 回调函数，将数据同步到 vue 中
                editor.config.onchange = (newHtml) => {
                    this.noticeForm.content = newHtml
                }
                // 配置菜单
                editor.config.menus = [
                    'bold',
                    'underline',
                    'italic',
                    'strikeThrough',
                    'quote',
                    'foreColor',
                    'backColor',
                    'fontSize',
                    'fontName',
                    'justify',
                    'code',
                    'image',
                    'video',
                    'indent',
                    'lineHeight',
                    'link',
                    'list',
                    'emoticon',
                    'table',
                    'undo',
                    'redo',
                ]
                // 配置 placeholder
                editor.config.placeholder = '请编辑公告内容'
                // 配置 server 上传图片接口地址
                editor.config.uploadImgServer = 'http://api.yixuetang.com/api/resource/upload/editor/userId/' + this.user.id
                // 配置上传文件参数名
                editor.config.uploadFileName = 'file';
                // 创建编辑器
                editor.create()
                this.noticeEditor = editor

                // 如果是编辑已发布的公告，需要回显数据
                if (this.isEditNotice) {
                    this.noticeEditor.txt.html(this.noticeForm.content);
                }
            },
            initExamEditor() {
                const editor = new wangEditor(`#examEditor`)
                // 配置 onchange 回调函数，将数据同步到 vue 中
                editor.config.onchange = (newHtml) => {
                    this.examForm.introduction = newHtml
                }
                // 配置菜单
                editor.config.menus = [
                    'bold',
                    'underline',
                    'italic',
                    'strikeThrough',
                    'quote',
                    'foreColor',
                    'backColor',
                    'fontSize',
                    'fontName',
                    'justify',
                    'code',
                    'image',
                    'video',
                    'indent',
                    'lineHeight',
                    'link',
                    'list',
                    'emoticon',
                    'table',
                    'undo',
                    'redo',
                ]
                // 配置 placeholder
                editor.config.placeholder = '请编辑测试（考试）简介'
                // 配置 server 上传图片接口地址
                editor.config.uploadImgServer = 'http://api.yixuetang.com/api/resource/upload/editor/userId/' + this.user.id
                // 配置上传文件参数名
                editor.config.uploadFileName = 'file';
                // 创建编辑器
                editor.create()
                this.examEditor = editor

                // 如果是编辑已建的测试（考试），需要回显数据
                if (this.isEditExam) {
                    this.examEditor.txt.html(this.examForm.introduction);
                }
            },
            destroyHomeworkEditor() {
                // 调用销毁 API 对当前编辑器实例进行销毁
                this.homeworkEditor.destroy()
                this.homeworkEditor = null
            },
            destroyNoticeEditor() {
                // 调用销毁 API 对当前编辑器实例进行销毁
                this.noticeEditor.destroy()
                this.noticeEditor = null
            },
            destroyExamEditor() {
                // 调用销毁 API 对当前编辑器实例进行销毁
                this.examEditor.destroy()
                this.examEditor = null
            },
            inputHomework(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        let t = this.homeworkForm.deadline;
                        this.homeworkForm.deadline = yxt.formatDate(t);
                        yxt.http.post("/homework/courseId/" + this.course.id + "/" + this.user.id, this.homeworkForm).then(({ data }) => {
                            if (data.success) {
                                this.$message.success(data.message);
                                this.getHomeworkData();
                            } else {
                                this.$message.error(data.message);
                            }
                            this.homeworkFormVisible = false;
                            this.homeworkForm = {};
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍后再试！");
                            this.homeworkFormVisible = false;
                            this.homeworkForm = {};
                        })
                    }
                });
            },
            inputNotice(formName) {
                this.notice_input = true;
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        yxt.http.post("/notice/courseId/" + this.course.id + "/" + this.user.id, this.noticeForm).then(({ data }) => {
                            if (data.success) {
                                this.$message.success(data.message);
                                this.getNoticeData();
                            } else {
                                this.$message.error(data.message);
                            }
                            this.noticeFormVisible = false;
                            this.noticeForm = {};
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍后再试！");
                            this.noticeFormVisible = false;
                            this.noticeForm = {};
                        })
                    }
                });
            },
            inputExam(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        let t = this.examForm.startTime;
                        this.examForm.startTime = yxt.formatDate(t);
                        if (this.examForm.endTime !== undefined) {
                            let t2 = this.examForm.endTime;
                            this.examForm.endTime = yxt.formatDate(t2);
                        }
                        yxt.http.post("/exam/courseId/" + this.course.id, this.examForm).then(({ data }) => {
                            if (data.success) {
                                this.$message.success(data.message);
                                this.examFormVisible = false;
                                this.examForm = {};
                                this.getExamData();
                            } else {
                                this.$message.error(data.message);
                            }
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍后再试！");
                            this.examFormVisible = false;
                            this.examForm = {};
                        })
                    }
                });
            },
            showInputHomeworkForm() {
                this.homeworkFormVisible = true
                this.isEditHomework = false
                this.homeworkForm = {}
            },
            showInputNoticeForm() {
                this.noticeFormVisible = true
                this.isEditNotice = false
                this.noticeForm = {}
            },
            showInputExamForm() {
                this.examFormVisible = true
                this.isEditExam = false
                this.examForm = {}
            },
            showEditExamForm(examId) {
                yxt.http.get("/exam/info/examId/" + examId).then(({ data }) => {
                    if (data.success) {
                        this.examForm = data.queryResult.data[0];
                        this.examFormVisible = true;
                        this.isEditExam = true;
                    } else {
                        this.$message.error(data.message);
                    }
                })
            },
            showEditNoticeForm(noticeId) {
                yxt.http.get("/notice/noticeId/" + noticeId).then(({ data }) => {
                    if (data.success) {
                        this.noticeForm = data.queryResult.data[0];
                        this.noticeFormVisible = true;
                        this.isEditNotice = true;
                    } else {
                        this.$message.error(data.message);
                    }
                })
            },
            showEditHomeworkForm(homeworkId) {
                yxt.http.get("/homework/homeworkId/" + homeworkId).then(({ data }) => {
                    if (data.success) {
                        this.homeworkForm = data.queryResult.data[0];
                        this.homeworkFormVisible = true;
                        this.homeworkDeadline = this.homeworkForm.deadline;
                        this.isEditHomework = true;
                    } else {
                        this.$message.error(data.message);
                    }
                })
            },
            editHomework(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        let t = this.homeworkForm.deadline;
                        if (this.homeworkDeadline != t) {
                            this.homeworkForm.deadline = yxt.formatDate(t);
                        }
                        yxt.http.put("/homework/info/homeworkId/" + this.homeworkForm.id, this.homeworkForm).then(({ data }) => {
                            if (data.success) {
                                this.$message.success(data.message);
                                this.getHomeworkData();
                            } else {
                                this.$message.error(data.message);
                            }
                            this.isEditHomework = false;
                            this.homeworkFormVisible = false;
                            this.homeworkForm = {};
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍后再试！");
                            this.isEditHomework = false;
                            this.homeworkFormVisible = false;
                            this.homeworkForm = {};
                        })
                    }
                });
            },
            editNotice(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        yxt.http.put("/notice/info/noticeId/" + this.noticeForm.id, this.noticeForm).then(({ data }) => {
                            if (data.success) {
                                this.$message.success(data.message);
                                this.getNoticeData();
                            } else {
                                this.$message.error(data.message);
                            }
                            this.isEditNotice = false;
                            this.noticeFormVisible = false;
                            this.noticeForm = {};
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍后再试！");
                            this.isEditNotice = false;
                            this.noticeFormVisible = false;
                            this.noticeForm = {};
                        })
                    }
                });
            },
            editExam(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        let t = this.examForm.startTime;
                        this.examForm.startTime = yxt.formatDate(t);
                        if (this.examForm.endTime !== undefined) {
                            let t2 = this.examForm.endTime;
                            this.examForm.endTime = yxt.formatDate(t2);
                        }
                        yxt.http.put("/exam/info/examId/" + this.examForm.id, this.examForm).then(({ data }) => {
                            if (data.success) {
                                this.$message.success(data.message);
                                this.getExamData();
                            } else {
                                this.$message.error(data.message);
                            }
                            this.isEditExam = false;
                            this.examFormVisible = false;
                            this.examForm = {};
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍后再试！");
                            this.isEditExam = false;
                            this.examFormVisible = false;
                            this.examForm = {};
                        })
                    }
                });
            },
            deleteNotice(noticeId) {
                yxt.http.delete("/notice/courseId/" + noticeId).then(({ data }) => {
                    if (data.success) {
                        this.$message.success(data.message);
                        this.getNoticeData();
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                });
            },
            deleteExam(examId) {
                yxt.http.delete("/exam/examId/" + examId).then(({ data }) => {
                    if (data.success) {
                        this.$message.success(data.message);
                        this.getExamData();
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                });
            },
            deleteHomework(homeworkId) {
                yxt.http.delete("/homework/id/" + homeworkId + "/" + yxt.getUrlParam("id")).then(({ data }) => {
                    if (data.success) {
                        this.$message.success(data.message);
                        this.getHomeworkData();
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                });
            },
            updateCourse(formName) {
                this.dialogUpdateCourseFormVisible = false;
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        yxt.http.put("/courses/info/id/" + this.course.id + "/" + this.user.id, this.updateCourseForm).then(({ data }) => {
                            if (data.success) {
                                this.$message.success(data.message);
                                this.course = Object.assign({}, this.updateCourseForm);
                            } else {
                                this.$message.error(data.message);
                            }
                            this.dialogUpdateCourseFormVisible = false;
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍后再试！");
                            this.dialogUpdateCourseFormVisible = false;
                        })
                    }
                });
            },
            updateStatus(examId, actionType) {
                yxt.http.put("exam/status/examId/" + examId + "/teacherId/" + this.user.id + "/actionType/" + actionType).then(({ data }) => {
                    if (data.success) {
                        this.$message.success(data.message);
                        this.getExamData();
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试一次！")
                })
            },
            switchNoticeTop(noticeId) {
                yxt.http.put("/notice/topNum/noticeId/" + noticeId).then(({ data }) => {
                    if (data.success) {
                        this.getNoticeData();
                        this.$message.success(data.message);
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                })
            },
            switchExamTop(examId) {
                yxt.http.put("/exam/topNum/examId/" + examId).then(({ data }) => {
                    if (data.success) {
                        this.getExamData();
                        this.$message.success(data.message);
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                })
            },
            switchHomeworkTop(homeworkId) {
                yxt.http.put("/homework/topNum/homeworkId/" + homeworkId).then(({ data }) => {
                    if (data.success) {
                        this.getHomeworkData();
                        this.$message.success(data.message);
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                })
            },
            handleSelect2(key2, keyPath2) {
                this.activeIndex2 = key2;
            },
            verify() {
                yxt.http.get("/auth/verify/2").then(({ data }) => {
                    if (data.success) {
                        this.user = data.queryResult.data[0];
                        yxt.http.get("/users/info/id/" + this.user.id).then(({ data }) => {
                            this.userInfo = data.queryResult.data[0];
                            this.realName = this.userInfo.realName;
                            this.course.id = yxt.getUrlParam("id");
                            this.getCourseData();
                        });
                        this.getHomeworkData();
                        this.getUnreadMessageCount();
                        this.getStudentHomeworkData();
                        this.getExamData();
                    } else {
                        location.href = "../index.html"
                    }
                }).catch(() => {
                    location.href = "../index.html";
                });
            },
            logout() {
                yxt.http.delete("/auth/logout/2").then(({ data }) => {
                    if (data.success) {
                        location.href = "../login.html"
                    } else {
                        this.$message.error("服务器繁忙，请稍候再试！");
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！");
                })
            },
            getHomeworkData() {
                yxt.http.get("homework/courseId/" + yxt.getUrlParam("id") + "/" + this.user.id).then(({ data }) => {
                    if (data.success) {
                        this.homeworkList = data.queryResult.data;
                        this.homeworkCount = data.queryResult.total;
                    }
                })
            },
            getNoticeData() {
                yxt.http.get("notice/courseId/" + yxt.getUrlParam("id")).then(({ data }) => {
                    if (data.success) {
                        this.noticeList = data.queryResult.data;
                        this.noticeCount = data.queryResult.total;
                    }
                })
            },
            getResourceData(courseId, parentResourceId) {
                yxt.http.get("resource/courseId/" + courseId + "?parentResourceId=" + parentResourceId).then(({ data }) => {
                    if (data.success) {
                        this.resourceList = data.queryResult.data;
                        this.resourceCount = data.queryResult.total;
                        this.parentResourceId = parentResourceId;
                        // 更新面包屑导航信息
                        this.breadcrumb = '<button type="button" class="el-button el-button--text" onclick="getResourceData(' + yxt.getUrlParam("id") + ', ' + -1 + ')">所有文件</button>';
                        if (parentResourceId != -1) {
                            yxt.http.get("resource/ancestors/resourceId/" + parentResourceId).then(({ data }) => {
                                let ancestors = data.queryResult.data.reverse();
                                ancestors.forEach(resource => {
                                    this.breadcrumb += ' <i class="el-icon-arrow-right"></i> <button type="button" class="el-button el-button--text" onclick="getResourceData(' + this.course.id + ', ' + resource.id + ')">' + resource.name + '</button>'
                                })
                            })
                        }
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再次刷新页面！")
                })
            },
            getResourceSrcByName(resourceName) {
                return this.getResourceSrc(resourceName.substring(resourceName.lastIndexOf(".") + 1));
            },
            getResourceSrc(ext) {
                let extList = ['jpg', 'png', 'doc', 'ppt', 'pptx', 'mp4', 'pdf', 'xlsx', 'txt', 'zip']
                if (extList.includes(ext)) {
                    return "https://www.ketangpai.com/Public/Common/img/fileicon/file_ext_big_" + ext + ".png";
                }
                return "https://www.ketangpai.com/Public/Common/img/fileicon/file_ext_big_folder.png";
            },
            previewOrGetResourceData(resourceId, type, name) {
                if (type === 0) { // 文件类型是目录，获取其子级资源
                    this.getResourceData(this.course.id, resourceId);
                    this.parentResourceId = resourceId;
                } else if (type === 1) { // 文件类型是文件，打开文件预览页面
                    yxt.http.get("resource/resourceId/" + resourceId)
                        .then(({ data }) => {
                            if (data.success) {
                                let url = data.queryResult.data[0].location;
                                window.open("http://www.pava.run/preview/onlinePreview?url=" + encodeURIComponent(url))
                            } else {
                                this.$message.error(data.message);
                            }
                        })
                        .catch(() => {
                            this.$message.error("服务器繁忙，请稍候再试！")
                        })
                } else {
                    this.$message.error("服务器繁忙，请稍候再试！")
                }
            },
            postDownloadRequestToServer(resourceId) {
                yxt.http.get("resource/download/resourceId/" + resourceId, {
                    responseType: 'blob'
                }).then(resp => {
                    yxt.http.get("resource/resourceId/" + resourceId)
                        .then(({ data }) => {
                            if (data.success) {
                                let fileName = data.queryResult.data[0].name;
                                this.download(resp.data, fileName);
                            } else {
                                this.$message.error(data.message);
                            }
                        })
                        .catch(() => {
                            this.$message.error("服务器繁忙，请稍候再试！")
                        })
                }).catch("服务器繁忙，请稍候再试！")
            },
            download(data, fileName) {
                let url = window.URL.createObjectURL(data)
                let link = document.createElement('a')
                link.style.display = 'none'
                link.href = url
                link.download = fileName // 设置文件名
                document.body.appendChild(link)
                link.click()
                window.URL.revokeObjectURL(link.href);
            },
            createFolder(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        this.resourceForm.courseId = this.course.id;
                        yxt.http.post("resource/folder/userId/" + this.user.id + "?parentResourceId=" + this.parentResourceId, this.resourceForm).then(({ data }) => {
                            if (data.success) {
                                this.createFolderFormVisible = false;
                                this.$message.success(data.message);
                                this.getResourceData(this.course.id, this.parentResourceId);
                            } else {
                                this.$message.error(data.message);
                            }
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍候再试！")
                        })
                    }
                });
            },
            uploadResource(f) {
                let formdata = new FormData()
                formdata.append('file', f.file)
                yxt.http({
                    url: '/resource/upload/userId/' + this.user.id + "?parentResourceId=" + this.parentResourceId,
                    method: 'post',
                    data: formdata,
                    headers: { 'Content-Type': 'multipart/form-data' }
                }).then(({ data }) => {
                    if (data.success) {
                        const courseResource = {
                            teacherId: this.user.id,
                            courseId: this.course.id,
                            resourceId: data.queryResult.data[0].id
                        }
                        yxt.http.post("/resource/courseResource", courseResource).then(({ data }) => {
                            if (data.success) {
                                this.$message.success(data.message);
                                this.getResourceData(this.course.id, this.parentResourceId);
                            } else {
                                this.$message.error(data.message);
                            }
                        })
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch((() => {
                    this.$message.error("服务器繁忙，请稍候再试！");
                }));
            },
            // 上传资源前的过滤
            beforeResourceUpload(file) {
                const fileTypes = ["image/jpeg", "image/png", "video/mpeg4", "video/mp4",
                    "video/avi", "application/msword", "application/x-xls", "application/pdf",
                    "application/x-ppt", "application/vnd.ms-powerpoint", "text/plain",
                    "application/vnd.openxmlformats-officedocument.presentationml.presentation",
                    "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    "application/x-zip-compressed"];
                const isValidType = fileTypes.indexOf(file.type) != -1;

                if (!isValidType) {
                    this.$message.error('暂不支持该文件类型！');
                    return false;
                }
                return true;
            },
            getSimpleText(html) {
                let re1 = new RegExp("<.+?>", "g"); // 匹配 html 标签的正则表达式，"g"是搜索匹配多个符合的内容
                return html.replace(re1, '');
            },
            getUnreadMessageCount() {
                yxt.http.get("message/unreadCount/userId/" + this.user.id).then(({ data }) => {
                    if (data.success) {
                        this.unreadMessageCount = data.queryResult.data[0];
                    }
                })
            },
            getCourseResourceList() {
                yxt.http.get("resource/all/courseId/" + yxt.getUrlParam("id")).then(({ data }) => {
                    if (data.success) {
                        this.courseResourceList = data.queryResult.data;
                    }
                })
            },
            remove(node, resource) {
                yxt.http.delete("resource/resourceId/" + resource.id + "/userId/" + this.user.id).then(({ data }) => {
                    if (data.success) {
                        this.$message.success(data.message);
                        this.getCourseResourceList();
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                })
            },
            showRenameResourceForm(node, resource) {
                yxt.http.get("resource/resourceId/" + resource.id).then(({ data }) => {
                    if (data.success) {
                        this.resourceForm = data.queryResult.data[0];
                        this.renameResourceFormVisible = true;
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                })
            },
            renameResource(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        yxt.http.put("resource/resourceId/" + this.resourceForm.id, this.resourceForm).then(({ data }) => {
                            if (data.success) {
                                this.renameResourceFormVisible = false;
                                this.$message.success(data.message);
                                this.getCourseResourceList();
                            } else {
                                this.$message.error(data.message);
                            }
                        }).catch(() => {
                            this.$message.error("服务器繁忙，请稍候再试！")
                        })
                    }
                });
            },
            handleDrop(draggingNode, dropNode, dropType, ev) {
                let dropResource = {
                    dropId: dropNode.data.id,
                    dropType: dropType
                }
                yxt.http.put("resource/parentResourceId/resourceId/" + draggingNode.data.id, dropResource).then(({ data }) => {
                    if (data.success) {
                        this.$message.success(data.message);
                    } else {
                        this.$message.error(data.message);
                    }
                    this.getCourseResourceList();
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                    this.getCourseResourceList();
                })
            },
            getStudentHomeworkData() {
                if (!this.user.isTeacher) {
                    yxt.http.get("homework/courseId/" + yxt.getUrlParam("id") + "/studentId/" + this.user.id).then(({ data }) => {
                        if (data.success) {
                            let tempHomeworkStudents = data.queryResult.data;
                            tempHomeworkStudents.forEach(tempHomeworkStudent =>
                                this.studentHomework[tempHomeworkStudent.homeworkId] = tempHomeworkStudent.status)
                        }
                    })
                }
            },
            getCourseData() {
                yxt.http.get("/courses/info/id/" + this.course.id).then(({ data }) => {
                    this.course = data.queryResult.data[0];
                    this.updateCourseForm = Object.assign({}, this.course);
                })
            },
            resetCourseCode() {
                yxt.http.put("courses/code/courseId/" + yxt.getUrlParam("id")).then(({ data }) => {
                    if (data.success) {
                        this.$message.success(data.message);
                        this.getCourseData();
                    } else {
                        this.$message.error(data.message);
                    }
                }).catch(() => {
                    this.$message.error("服务器繁忙，请稍候再试！")
                })
            },
            getExamData() {
                yxt.http.get("exam/courseId/" + yxt.getUrlParam("id") + "/userId/" + this.user.id).then(({ data }) => {
                    if (data.success) {
                        this.examList = data.queryResult.data;
                        this.examList.forEach(exam => {
                            exam.examStatus = this.getExamStatus(exam);
                        });
                        this.unreleasedExamList = this.examList.filter(exam => !exam.status);
                        let releasedExamList = this.examList.filter(exam => exam.status);
                        this.unstartedExamList = releasedExamList.filter(exam => new Date().valueOf() < new Date(exam.startTime).valueOf());
                        this.releasedExamList = releasedExamList.filter(exam => new Date().valueOf() >= new Date(exam.startTime).valueOf() &&
                            (exam.endTime === null || new Date().valueOf <= new Date(exam.endTime).valueOf()));
                        this.endedExamList = releasedExamList.filter(exam => exam.endTime !== null && new Date().valueOf() > new Date(exam.endTime).valueOf());
                    }
                })
            },
            getExamStatus(exam) {
                if (!exam.status) {
                    return "未发布";
                } else {
                    let currentTime = new Date().valueOf();
                    let examStartTime = new Date(exam.startTime).valueOf();
                    let examEndTime = exam.endTime === null ? null : new Date(exam.endTime).valueOf();
                    if (currentTime < examStartTime) {
                        return "未开始";
                    } else if (currentTime >= examStartTime &&
                        (examEndTime === null || currentTime <= examEndTime)) {
                        return "已发布";
                    } else if (exam.endTime !== null && currentTime > examEndTime) {
                        return "已结束";
                    } else {
                        return "未知测试状态"
                    }
                }
            },
            getExamStatusType(examStatus) {
                switch (examStatus) {
                    case "未发布":
                        return "danger";
                        break;
                    case "未开始":
                        return "warning";
                        break;
                    case "已发布":
                        return "success";
                        break;
                    case "已结束":
                        return "";
                        break;
                    default:
                        return "info";
                        break;
                }
            },
        },
        created() {
            this.verify();
            this.getNoticeData();
            this.getResourceData(yxt.getUrlParam("id"), -1);
            window.getResourceData = this.getResourceData;
        },
        computed: {
            resourceListRows() {
                const resourceListRows = [];
                this.resourceList.forEach((resource, index) => {
                    const row = Math.floor(index / 7);
                    if (!resourceListRows[row]) {
                        resourceListRows[row] = [];
                    }
                    resourceListRows[row].push(resource);
                })
                return resourceListRows;
            },
            totalUnreadCount() {
                let totalCount = 0;
                for (let key in this.unreadMessageCount) {
                    totalCount += this.unreadMessageCount[key];
                }
                return totalCount;
            },
        },
    })
</script>

</html>